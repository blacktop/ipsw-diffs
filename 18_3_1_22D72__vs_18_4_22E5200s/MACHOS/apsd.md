## apsd

> `/System/Library/PrivateFrameworks/ApplePushService.framework/apsd`

```diff

-1100.400.110.0.0
-  __TEXT.__text: 0xc79cc
-  __TEXT.__auth_stubs: 0x2620
-  __TEXT.__objc_stubs: 0xf7a0
+1100.500.81.0.0
+  __TEXT.__text: 0xcdde8
+  __TEXT.__auth_stubs: 0x26f0
+  __TEXT.__objc_stubs: 0xfbe0
   __TEXT.__init_offsets: 0x8
-  __TEXT.__objc_methlist: 0x9920
-  __TEXT.__objc_methname: 0x18bd7
-  __TEXT.__objc_classname: 0xdc2
-  __TEXT.__objc_methtype: 0x432d
-  __TEXT.__cstring: 0x9274
-  __TEXT.__const: 0x1e51
-  __TEXT.__oslogstring: 0x11333
-  __TEXT.__gcc_except_tab: 0x24e0
+  __TEXT.__objc_methlist: 0xb3b8
+  __TEXT.__objc_methname: 0x19320
+  __TEXT.__objc_classname: 0xe00
+  __TEXT.__objc_methtype: 0x4626
+  __TEXT.__cstring: 0x9ef4
+  __TEXT.__const: 0x1ff1
+  __TEXT.__oslogstring: 0x11d10
+  __TEXT.__gcc_except_tab: 0x24dc
   __TEXT.__dlopen_cstrs: 0xae
-  __TEXT.__constg_swiftt: 0x48c
-  __TEXT.__swift5_typeref: 0x30f
-  __TEXT.__swift5_reflstr: 0x269
-  __TEXT.__swift5_fieldmd: 0x284
-  __TEXT.__swift5_types: 0x3c
-  __TEXT.__swift5_builtin: 0x3c
+  __TEXT.__constg_swiftt: 0x644
+  __TEXT.__swift5_typeref: 0x47d
+  __TEXT.__swift5_reflstr: 0x389
+  __TEXT.__swift5_fieldmd: 0x32c
+  __TEXT.__swift5_types: 0x4c
+  __TEXT.__swift5_builtin: 0x50
   __TEXT.__swift5_mpenum: 0x8
-  __TEXT.__swift5_proto: 0x10
-  __TEXT.__unwind_info: 0x3080
-  __TEXT.__eh_frame: 0xb0
-  __DATA_CONST.__auth_got: 0x1328
-  __DATA_CONST.__got: 0x758
-  __DATA_CONST.__auth_ptr: 0x98
-  __DATA_CONST.__const: 0x52e0
-  __DATA_CONST.__cfstring: 0x7ee0
-  __DATA_CONST.__objc_classlist: 0x3b0
-  __DATA_CONST.__objc_protolist: 0x1f0
+  __TEXT.__swift5_proto: 0x18
+  __TEXT.__swift5_capture: 0x5c
+  __TEXT.__swift5_assocty: 0x18
+  __TEXT.__unwind_info: 0x3208
+  __TEXT.__eh_frame: 0x108
+  __DATA_CONST.__auth_got: 0x1390
+  __DATA_CONST.__got: 0x770
+  __DATA_CONST.__auth_ptr: 0xe8
+  __DATA_CONST.__const: 0x54e0
+  __DATA_CONST.__cfstring: 0x8220
+  __DATA_CONST.__objc_classlist: 0x3c8
+  __DATA_CONST.__objc_protolist: 0x200
   __DATA_CONST.__objc_imageinfo: 0x8
-  __DATA_CONST.__objc_protorefs: 0x68
-  __DATA_CONST.__objc_superrefs: 0x318
-  __DATA_CONST.__objc_intobj: 0x300
+  __DATA_CONST.__objc_protorefs: 0x70
+  __DATA_CONST.__objc_superrefs: 0x320
+  __DATA_CONST.__objc_intobj: 0x330
   __DATA_CONST.__objc_arraydata: 0x68
   __DATA_CONST.__objc_dictobj: 0xc8
   __DATA_CONST.__objc_arrayobj: 0x30
   __DATA_CONST.__objc_doubleobj: 0x10
-  __DATA.__objc_const: 0x18678
-  __DATA.__objc_selrefs: 0x50a0
-  __DATA.__objc_ivar: 0xbc8
-  __DATA.__objc_data: 0x2d38
-  __DATA.__data: 0x1758
-  __DATA.__bss: 0x5c0
-  __DATA.__common: 0x148
+  __DATA.__objc_const: 0x17eb8
+  __DATA.__objc_selrefs: 0x5310
+  __DATA.__objc_ivar: 0xbec
+  __DATA.__objc_data: 0x2da8
+  __DATA.__data: 0x18e8
+  __DATA.__bss: 0x690
+  __DATA.__common: 0x100
   - /System/Library/Frameworks/CFNetwork.framework/CFNetwork
   - /System/Library/Frameworks/CoreFoundation.framework/CoreFoundation
   - /System/Library/Frameworks/CoreServices.framework/CoreServices

   - /usr/lib/swift/libswiftos.dylib
   - /usr/lib/swift/libswiftsys_time.dylib
   - /usr/lib/swift/libswiftunistd.dylib
-  Functions: 4566
-  Symbols:   899
-  CStrings:  7055
+  Functions: 4805
+  Symbols:   926
+  CStrings:  7240
 
Symbols:
+ _$s10Foundation22_convertErrorToNSErrorySo0E0Cs0C0_pF
+ _$s10Foundation22_convertNSErrorToErrorys0E0_pSo0C0CSgF
+ _$s10Foundation4DataV11descriptionSSvg
+ _$s10Foundation4DataV19_bridgeToObjectiveCSo6NSDataCyF
+ _$s10Foundation4DataVMn
+ _$s10ObjectiveC8ObjCBoolVMn
+ _$s2os0A4_log_3dso0B0__ySo0a1_B7_type_ta_SVSo03OS_a1_B0Cs12StaticStringVs7CVarArg_pdtF
+ _$s8RawValueSYTl
+ _$sSS8UTF8ViewV13_foreignCountSiyF
+ _$sSY8rawValue03RawB0QzvgTq
+ _$sSY8rawValuexSg03RawB0Qz_tcfCTq
+ _$sSYMp
+ _$sSo13os_log_type_ta0A0E5errorABvgZ
+ _$sSo13os_log_type_ta0A0E5faultABvgZ
+ _$ss11_StringGutsV8copyUTF84intoSiSgSrys5UInt8VG_tF
+ _$ss11_StringGutsVN
+ _$ss13_StringObjectV10sharedUTF8SRys5UInt8VGvg
+ _$ss5ErrorMp
+ _$ss5UInt8VMn
+ _APSRollTokenEntitlement
+ _APSUseMultiIdentityProvider
+ _NSDebugDescriptionErrorKey
+ _NSStringFromClass
+ __ZNSt3__117bad_function_callD1Ev
+ __ZTINSt3__117bad_function_callE
+ __ZTVNSt3__117bad_function_callE
+ _objc_release_x2
+ _swift_arrayDestroy
+ _swift_arrayInitWithCopy
+ _swift_bridgeObjectRelease_n
+ _swift_deallocObject
+ _swift_errorRelease
+ _swift_errorRetain
+ _swift_initStackObject
- _$sSa12_endMutationyyFyXl_Ts5
- _$sSw10copyMemory4fromySW_tF
- _$ss18_fatalErrorMessage__4file4line5flagss5NeverOs12StaticStringV_A2HSus6UInt32VtF
- __ZNKSt9exception4whatEv
- __ZNSt9exceptionD2Ev
- _objc_retain_x10
- _swift_once
CStrings:
+ "\x01\x11\x17"
+ "\x01A"
+ "\x14\x12"
+ "\x1a\x14\x13r\x12\x17!\x11'\x12\x12?"
+ "%@ asked to add errors to consecutiveConnectionFailureReason on invalid interface %@"
+ "%@ default set, forcing invalid albert cert"
+ "%@ informed of a valid server presence. Ignoring."
+ "%@ informed of an invalid server presence. Not doing anything, the next presence will use the same identity."
+ "%@ swapping identity providers not supported, not using a multi identity provider"
+ "%@: Cached token: %@, type: %ld"
+ "%@: Client identity manager is noting a refresh in BAA certs, rolling push token for all environments in BAA"
+ "%@: Client identity manager is noting a swap in identity provider, clearing public token and terminating connection."
+ "%@: Received an invalid presence response with reason %@"
+ "%@: SecResult shows duplicate item, trying to update it. setTokenForDomain %@ appSpecificIdentifier %@  tokenData %@"
+ "%@: setTokenForDomain %@ tokenData %@ appSpecificIdentifier %@"
+ "644392"
+ "<user=%@, activeClients=%@, shouldUseInternet=%@, publicToken=%@, isIdentityAvailable=%@, identityStatus=%@, connectionServers=%@, deviceTopicManager=%@, channels=%@>"
+ "@\"<APSUserDependencies>\"40@0:8@\"<APSUser>\"16@\"APSEnvironment\"24@\"<APSClientIdentityProvider>\"32"
+ "@\"APSSystemTokenInfo\"24@0:8@\"APSEnvironment\"16"
+ "APNSBAARetryCount"
+ "APNSEnableBAAAuthenticationForAVP"
+ "APNSEnableBAAFallback"
+ "APNSUseBAAAuthenticationForDevicesPercentage"
+ "APSAliasUserIdentityProvider"
+ "APSBAAClientIdentityProvider failed to sign nonce with host VM identity, error: %@"
+ "APSClientIdentityProviderErrorDomain"
+ "APSMultiClientIdentityProvider"
+ "APSMultiClientIdentityProviderDelegate"
+ "APSProtocolInvalidPresenceReason"
+ "APSProtocolServerRequestedTTR"
+ "APSSystemTokenInfo"
+ "APSSystemTokenInfo Serializing system token info to store in keychain, token: %@, type: %ld"
+ "APSSystemTokenInfo no token info found in keychain"
+ "APSSystemTokenInfoToken"
+ "APSSystemTokenInfoType"
+ "APSTokenStore fetching system token from keychain, environment: %@"
+ "APSTokenStore migrating token to new token info!"
+ "APSTokenStore setting system token in keychain for environment %@, token: %@, type: %ld"
+ "APSTokenStore storing no token in keychain"
+ "APSXPCRollTokensAndReconnectEvent, not entitled to roll tokens!"
+ "APSXPCRollTokensAndReconnectEvent, rolling tokens and forcing a reconnect"
+ "APSXPCSwapIdentityProviderEvent, asking %@ courier to swap identity providers"
+ "Albert"
+ "An internal APNS error has been detected, please file a radar!"
+ "Apple Push Service"
+ "B68@0:8^{__SecKey={__CFRuntimeBase=QAQ}^{__SecKeyDescriptor}^v}16^{__SecKey={__CFRuntimeBase=QAQ}^{__SecKeyDescriptor}^v}24@\"NSData\"32@\"NSNumber\"40B48^@52^@60"
+ "B68@0:8^{__SecKey={__CFRuntimeBase=QAQ}^{__SecKeyDescriptor}^v}16^{__SecKey={__CFRuntimeBase=QAQ}^{__SecKeyDescriptor}^v}24@32@40B48^@52^@60"
+ "B68@0:8^{__SecKey=}16^{__SecKey=}24@\"NSData\"32@\"NSNumber\"40B48^@52^@60"
+ "B68@0:8^{__SecKey=}16^{__SecKey=}24@32@40B48^@52^@60"
+ "BAA"
+ "BAAPhysicalDevicesInternal"
+ "Did not find APSSystemTokenInfo in keychain, token was stored as data directly: %@"
+ "Failed to deserialize APSSystemTokenInfo, error: %@"
+ "Force BAA cert failure default set"
+ "Force invalid albert cert default set"
+ "Found APSSystemTokenInfo, returning deserialized token info"
+ "Found an existing token in keychain to init clientIdentityManager for environment %@, token: %@, type: %s"
+ "Found an existing token in keychain to init multiClientIdentityProvider for environment %s, token: %s, type: %s"
+ "I Didn't Try"
+ "IDSTapToRadar"
+ "IDSTapToRadarContext"
+ "IDSTapToRadarRequest"
+ "Incoming Proxy Messages"
+ "Internal Push Error Detected"
+ "MultiClientIdentityProvider albert provider not available, not swapping"
+ "MultiClientIdentityProvider attempting another BAA token before swapping identity provider"
+ "MultiClientIdentityProvider attempting to swap active identity provider"
+ "MultiClientIdentityProvider baa provider not available, not swapping"
+ "MultiClientIdentityProvider clearing presence errors after a successful presence"
+ "MultiClientIdentityProvider fetching identity, attempt number %ld"
+ "MultiClientIdentityProvider has BAA been disabled? %{bool}d"
+ "MultiClientIdentityProvider identity fetch failed"
+ "MultiClientIdentityProvider identity fetch failed too many times, swapping identity provider and returning no identity"
+ "MultiClientIdentityProvider identity provider not currently available, identity is not available"
+ "MultiClientIdentityProvider informed of a push token loss, attempting to upgrade to BAA if possible"
+ "MultiClientIdentityProvider noting an invalid presence from server"
+ "MultiClientIdentityProvider retrying identity fetch, retry #%ld"
+ "MultiClientIdentityProvider server bag has disabled BAA! Swapping identity providers"
+ "MultiClientIdentityProvider swapping identity provider if possible"
+ "MultiClientIdentityProvider swapping to BAA provider"
+ "MultiClientIdentityProvider swapping to albert provider"
+ "MultiClientIdentityProvider updating albert fallback enabled to %{bool}d"
+ "MultiClientIdentityProvider updating baa enabled to %{bool}d"
+ "MultiClientIdentityProvider updating retry count to %ld"
+ "MultiClientIdentityProvider updating server bag values"
+ "MultiClientIdentityProvider, currentIdentityProvider: %s, isIdentityAvailable:%{bool}d"
+ "MultiIdentityProvider default not set, rolled %u, shouldUseMultiProvider %@?"
+ "MultiIdentityProvider default set to not use multi identity provider"
+ "MultiIdentityProvider default set to use multi identity provider"
+ "No server reason given"
+ "No token found in keychain for environment %%%s, setting multiClientIdentityProvider status to BAA"
+ "No token found in keychain for environment %@, setting clientIdentityManager status to BAA"
+ "Outgoing Proxy Messages"
+ "Serious Bug"
+ "Server requested TTR, presence error reason: %@"
+ "T@\"<APSClientIdentityProvider>\",R,N,V_clientIdentityProvider"
+ "T@\"<APSClientIdentityProvider>\",W,N,V_identityProviderForMainCourier"
+ "T@\"<APSMultiClientIdentityProviderDelegate>\",N,W,Vdelegate"
+ "T@\"NSData\",R,N,V_systemToken"
+ "T@\"NSMutableDictionary\",&,N,V_incomingPowerLogDictionary"
+ "T@\"NSMutableDictionary\",&,N,V_outgoingPowerLogDictionary"
+ "T@\"NSObject<OS_dispatch_source>\",&,N,V_powerLogTimer"
+ "TB,N,V_swappingIdentity"
+ "The saved token type is BAA but we are not using the multi identity provider. The default to use the multi provider was likely lost!"
+ "Tq,N,R"
+ "Tq,N,V_tokenType"
+ "Unsupported VM host cert fetch"
+ "User dependencies for non-default users require a main identity provider!"
+ "[APNS] Tap-to-Radar: Internal push error detected"
+ "_identityProviderForMainCourier"
+ "_incomingPowerLogDictionary"
+ "_outgoingPowerLogDictionary"
+ "_powerLogTimer"
+ "_reportProxyMessages"
+ "_startPowerLoggingMessages"
+ "_stopPowerLoggingMessages"
+ "_swappingIdentity"
+ "_systemToken"
+ "_tokenType"
+ "_triggerTTRFromServer:"
+ "addConnectionFailureReasons:onInterface:"
+ "albertFallbackEnabled"
+ "albertIdentityProvider"
+ "all"
+ "apsd.AliasUserIdentityProvider"
+ "apsd.MultiClientIdentityProvider"
+ "baaEnabled"
+ "baaEnabledForDevices"
+ "baaIdentityProvider"
+ "baaRetryCount"
+ "clearCachedIdentityAndTokens"
+ "currentIdentityState"
+ "currentTokenType"
+ "debugForceIdentitySwap"
+ "dependenciesForUser:environment:mainIdentityProvider:"
+ "dependenciesWithNoIdentityForUser:"
+ "errorsSinceLastSuccessfulServerPresence"
+ "fetchVMHostCertsAndSignData:error:"
+ "flagsForPresence"
+ "force-invalid-BAA-cert"
+ "force-invalid-albert-cert"
+ "forceInvalidAlbertCert"
+ "forceInvalidBAACert"
+ "generateNonceAndSignatureWithPublicKey:privateKey:dataToSign:time:useIDSNonceVersion:nonceOut:signatureOut:"
+ "identityFetchErrors"
+ "identityProviderForMainCourier"
+ "identityStatus"
+ "incomingPowerLogDictionary"
+ "initWithInt:"
+ "initWithMainUserIdentityProvider:"
+ "initWithPushTokenInKeychain:legacyIdentityProvider:delegate:"
+ "initWithSystemToken:type:"
+ "initWithTitle:message:"
+ "invalidateClientIdentity"
+ "kIDSTapToRadarClassificationKey"
+ "kIDSTapToRadarComponentIDKey"
+ "kIDSTapToRadarComponentNameKey"
+ "kIDSTapToRadarComponentVersionKey"
+ "kIDSTapToRadarDescriptionKey"
+ "kIDSTapToRadarReproducibilityKey"
+ "kIDSTapToRadarTitleKey"
+ "launchWithRequest:context:"
+ "mainUserIdentityProvider"
+ "multiClientIdentityRampPercentage"
+ "noteInvalidServerPresence"
+ "notePushTokenLost"
+ "noteServerBagUpdate:"
+ "noteValidServerPresence"
+ "outgoingPowerLogDictionary"
+ "powerLogTimer"
+ "sendConnectMessageWithToken:presenceFlags:certificates:nonce:signature:hostCertificateInfo:connectionErrors:withCompletion:"
+ "serializeSystemTokenInfo"
+ "setIdentityProviderForMainCourier:"
+ "setIncomingPowerLogDictionary:"
+ "setIsIdentityAvailableBlockWithBlock:"
+ "setOutgoingPowerLogDictionary:"
+ "setPowerLogTimer:"
+ "setSwappingIdentity:"
+ "setSystemTokenInfo:forUser:"
+ "setTokenData:withDomain:appSpecificIdentifier:tokenServiceSuffix:user:topic:"
+ "setTokenInfo:forEnvironment:"
+ "setTokenType:"
+ "shouldSwapIdentityProviderAfterNextInvalidPresence"
+ "signatureTypeForSigning"
+ "supportsFetchingVMHostCerts"
+ "swappingIdentity"
+ "systemToken"
+ "systemTokenInfoForUser:"
+ "systemTokenInfoFromData:"
+ "tokenInfoForEnvironment:"
+ "tokenType"
+ "v24@0:8@\"APSConfiguration\"16"
+ "v28@0:8B16@?<v@?^{__SecKey={__CFRuntimeBase=QAQ}^{__SecKeyDescriptor}^v}@\"NSArray\"@\"NSError\">20"
+ "v28@0:8B16@?<v@?^{__SecKey=}@\"NSArray\"@\"NSError\">20"
+ "v32@0:8@\"APSSystemTokenInfo\"16@\"APSEnvironment\"24"
+ "v32@?0^{__SecKey=}8@\"NSArray\"16@\"NSError\"24"
+ "v76@0:8@\"NSData\"16I24@\"NSArray\"28@\"NSData\"36@\"NSData\"44@\"APSDProtoHostCertificateInfo\"52@\"NSArray\"60@?<v@?@\"NSDictionary\"@\"NSError\">68"
+ "v76@0:8@16I24@28@36@44@52@60@?68"
- "\x01\x11\x14"
- "\x16"
- "\x1a\x14\x13r\x12\x17!\x11'\x12\x12/"
- "%@: BAA client identity provider is noting a refresh in BAA certs, noting to daemon to roll tokens for all environments in BAA"
- "%@: SecResult shows duplicate item, trying to update it. setTokenForDomain %@ appSpecificIdentifier %@  token %@"
- "%@: setTokenForDomain %@ token %@ appSpecificIdentifier %@"
- "<user=%@, activeClients=%@, shouldUseInternet=%@, publicToken=%@, isIdentityAvailable=%@, connectionServers=%@, deviceTopicManager=%@, channels=%@>"
- "@\"NSData\"24@0:8@\"APSEnvironment\"16"
- "APSBAAClientIdenittyProvider failed to sign nonce with host VM identity, error: %@"
- "Fatal error"
- "No host identity to fetch with no op identity provider, returning empty host certificate info which will be ignored by the courier"
- "Swift/UnsafePointer.swift"
- "T@\"<APSClientIdentityProvider>\",&,N,V_clientIdentityProvider"
- "UnsafeMutablePointer.initialize overlapping range"
- "UnsafeMutablePointer.initialize with negative count"
- "deleteClientIdentityRequestingReplacement"
- "dependenciesForUser:"
- "fetchHostVMCertAndSignNonce:error:"
- "setClientIdentityProvider:"
- "setToken:forEnvironment:"
- "setToken:withDomain:appSpecificIdentifier:tokenServiceSuffix:user:topic:"
- "systemTokenForUser:"
- "tokenForEnvironment:"
- "v28@0:8B16@?<v@?^{__SecKey={__CFRuntimeBase=QAQ}^{__SecKeyDescriptor}^v}@\"NSArray\">20"
- "v28@0:8B16@?<v@?^{__SecKey=}@\"NSArray\">20"
- "v32@0:8@\"NSData\"16@\"APSEnvironment\"24"

```
