## IMDPersistence

> `/System/Library/PrivateFrameworks/IMDPersistence.framework/IMDPersistence`

```diff

-1261.100.4.2.35
-  __TEXT.__text: 0x111378
+1261.200.71.2.16
+  __TEXT.__text: 0x112fcc
   __TEXT.__auth_stubs: 0x23b0
-  __TEXT.__objc_methlist: 0x2cac
+  __TEXT.__objc_methlist: 0x2cb4
   __TEXT.__const: 0x8aa
-  __TEXT.__cstring: 0x566c1
-  __TEXT.__oslogstring: 0x17962
-  __TEXT.__gcc_except_tab: 0x96b8
+  __TEXT.__cstring: 0x56d71
+  __TEXT.__oslogstring: 0x17cd8
+  __TEXT.__gcc_except_tab: 0x97d4
   __TEXT.__ustring: 0x430
   __TEXT.__dlopen_cstrs: 0x2a4
   __TEXT.__constg_swiftt: 0x140

   __TEXT.__swift5_capture: 0xe4
   __TEXT.__swift5_types: 0x14
   __TEXT.__swift5_reflstr: 0x4f
-  __TEXT.__unwind_info: 0x44cc
+  __TEXT.__unwind_info: 0x453c
   __TEXT.__eh_frame: 0x78
   __TEXT.__objc_classname: 0x870
-  __TEXT.__objc_methname: 0xd415
-  __TEXT.__objc_methtype: 0x1c4e
-  __TEXT.__objc_stubs: 0xb400
+  __TEXT.__objc_methname: 0xd491
+  __TEXT.__objc_methtype: 0x1c4a
+  __TEXT.__objc_stubs: 0xb4a0
   __DATA_CONST.__got: 0x530
-  __DATA_CONST.__const: 0xfd08
+  __DATA_CONST.__const: 0xfd40
   __DATA_CONST.__objc_classlist: 0x200
   __DATA_CONST.__objc_catlist: 0x18
   __DATA_CONST.__objc_protolist: 0xe0
   __DATA_CONST.__objc_imageinfo: 0x8
   __DATA_CONST.__objc_const: 0x3e78
-  __DATA_CONST.__objc_selrefs: 0x30f8
+  __DATA_CONST.__objc_selrefs: 0x3120
   __DATA_CONST.__objc_arraydata: 0x180
-  __AUTH_CONST.__cfstring: 0x17100
+  __AUTH_CONST.__cfstring: 0x176a0
   __AUTH_CONST.__objc_const: 0x0
   __AUTH_CONST.__objc_intobj: 0x138
-  __AUTH_CONST.__const: 0x680
+  __AUTH_CONST.__const: 0x880
   __AUTH_CONST.__objc_arrayobj: 0x78
   __AUTH_CONST.__auth_got: 0x11e8
   __AUTH.__objc_data: 0x50
   __DATA.__objc_protorefs: 0x58
-  __DATA.__objc_classrefs: 0x618
+  __DATA.__objc_classrefs: 0x620
   __DATA.__objc_superrefs: 0xc8
   __DATA.__objc_ivar: 0x14c
-  __DATA.__data: 0x8b0
+  __DATA.__data: 0x8a0
   __DATA.__bss: 0x2f0
   __DATA.__common: 0x11
-  __DATA_DIRTY.__const: 0x1d48
+  __DATA_DIRTY.__const: 0x1b28
   __DATA_DIRTY.__objc_const: 0x1668
   __DATA_DIRTY.__objc_data: 0x15a0
   __DATA_DIRTY.__data: 0x290

   - /usr/lib/swift/libswiftXPC.dylib
   - /usr/lib/swift/libswiftos.dylib
   - /usr/lib/swift/libswiftsimd.dylib
-  UUID: 515137AE-4551-3036-8589-2833D8DF9F5C
-  Functions: 4109
-  Symbols:   2139
-  CStrings:  10434
+  UUID: 755E4517-37EE-3F6A-95BA-7599D5A21606
+  Functions: 4125
+  Symbols:   2146
+  CStrings:  10539
 
Symbols:
+ _IMDCNGivenNameAndBirthdayForHandleID
+ _IMDMessageRecordCopyMessagesPendingUpdateT3ToCloudKitWithLimit
+ _OBJC_CLASS_$_IMContactUtilities
+ ___XPCServerIMDCNGivenNameAndBirthdayForHandleID_IPCAction
+ ___XPCServerIMDMessageRecordCopyMessagesPendingUpdateT3ToCloudKit_IPCAction
+ ___syncXPCIMDCNGivenNameAndBirthdayForHandleID_IPCAction
+ ___syncXPCIMDMessageRecordCopyMessagesPendingUpdateT3ToCloudKit_IPCAction
CStrings:
+ ", associatedMessageGUID from %@ to %@"
+ ", associatedMessageType from %@ to %@"
+ ", body changed"
+ ", cloudKitSyncState from %lld to %lld"
+ ", dateEdited from %@ to %@"
+ ", destinationCallerID from %@ to %@"
+ ", errorCode from %@ to %@"
+ ", expireState from %lld to %lld"
+ ", expressiveSendStyleID from %@ to %@"
+ ", fileTransferGUIDs from %@ to %@"
+ ", flags from %@ to %@"
+ ", hasUnseenMention from %@ to %@"
+ ", replyToGUID from %@ to %@"
+ ", service from %@ to %@"
+ ", sortID from %@ to %@"
+ ", subject changed"
+ ", syncedSyndicationRanges from %@ to %@"
+ ", syndicationRanges from %@ to %@"
+ ", threadIdentifier from %@ to %@"
+ ", time from %@ to %@"
+ ", timeDelivered from %@ to %@"
+ ", timeExpressiveSendPlayed from %@ to %@"
+ ", timePlayed from %@ to %@"
+ ", timeRead from %@ to %@"
+ "@40@0:8Q16Q24@32"
+ "Action: Get contact given name and birthday for handle id"
+ "Failed to get FPProviderID:%@ for URL. Error: %@"
+ "Failed to get a collaboration identifier for URL hence setting message to be shared only in SWY"
+ "Found message %lld/%@ to update"
+ "Found message %lld/%@ to update : originator GUID/part: %@/%@"
+ "Found resolved URL for item %@"
+ "Host for URL not in ValidSharingURLs so not defaulting FPProviderID"
+ "IMDAttachmentQueryStringForIMAttachmentsQuery unknown IMAttachmentsQuery type %lld, fromRow %@"
+ "IMDCNGivenNameAndBirthdayForHandleID returning total Contact keys: %lu"
+ "IMDCoreSpotlight: Got a Contact for address %@. Caching and returning contact: %@"
+ "IMDMessageRecordCopyMessagesPendingUpdateT3ToCloudKitWithLimit called with limit %lld"
+ "IMMessageItem: %@"
+ "Invalid ResolvedURL"
+ "Message Update v3 Query - unable to create row dictionary for messageId: %@, skipping!"
+ "Message Update v3 query got invalid column data back: rowid %lld messageId:%@"
+ "Message was not sent after call start time %@ message send time: %@, so not updating conversation with highlight dictionary %@"
+ "NOT Appending highlight metadata Message: %@ since LP recommended that we do not."
+ "No CKBundleIDs found for URL with messageGUID: %@"
+ "Not setting FPProviderID: %@ for URL in CSSI. FileName: %@"
+ "SELECT * FROM attachment a WHERE a.ck_sync_state == 0 ORDER BY a.ROWID LIMIT ? "
+ "SELECT * FROM attachment a WHERE a.ck_sync_state == 0 and a.ROWID > ? ORDER BY a.ROWID LIMIT ? "
+ "SELECT * FROM attachment a WHERE a.ck_sync_state == 1 AND a.transfer_state == 0 AND a.ROWID > ? ORDER BY a.ROWID LIMIT ? "
+ "SELECT * FROM attachment a WHERE a.ck_sync_state == 1 AND a.transfer_state == 0 ORDER BY a.ROWID LIMIT ? "
+ "SELECT ROWID, guid FROM message where ck_sync_state == 9 AND (service == 'iMessage' OR service == 'SMS') order by date limit ? ;"
+ "SELECT ck_sync_state, COUNT(*) AS total_count FROM message AS m INNER JOIN chat_message_join AS cmj ON m.ROWID = cmj.message_id GROUP BY m.ck_sync_state;"
+ "SELECT ck_sync_state, COUNT(*) FROM chat GROUP BY ck_sync_state;"
+ "Setting FPProviderID: %@ for URL in CSSI"
+ "Setting default FileProviderID for URL"
+ "Since we failed to get LPLinkMetadata, not asking LP's recommendation here."
+ "Status %ld"
+ "Status 1"
+ "URL was not classified as a CollaborationURL"
+ "URL was not classified as either WebURL or a News URL"
+ "Unexpected column in Message Update v3 with index %d"
+ "Updating %@"
+ "Updating conversation with highlight dictionary since call start date %@ is before message date %@"
+ "_copyNewSearchableIndexesForMessagesWithLastRowID:batchSize:timingCollection:"
+ "_fetchContactGivenNameAndBirthdayForHandleID:"
+ "attStats"
+ "callForConversationWithGroupUUID:"
+ "chatStats"
+ "cnHandleID"
+ "creationDate was distant past. Not setting contentCreationDate on attributesToUpdate."
+ "dateConnected"
+ "distantPast"
+ "getContactGivenNameAndBirthdayForHandleID:"
+ "lastIndexedRowID (%lld) < current sub batch size. Reaching the end of indexing all message records."
+ "md"
+ "messageDate was distant past. Not setting contentCreationDate on attributesToUpdate."
+ "messageDate was distant past. Not setting contentCreationDate on metadataAttributes."
+ "msgStats"
+ "total"
- "%@ was not classified as a CollaborationURL"
- "%@ was not classified as either WebURL or a News URL"
- "-[IMDCoreSpotlightManager indexNextMessageBatchIfNeeded:completion:]_block_invoke"
- "@48@0:8Q16Q24^i32@40"
- "Failed to get FPProviderID:%@ for URL %@. Error: %@"
- "Failed to get a collaboration identifier for URL: %@ hence setting message to be shared only in SWY"
- "Found message %lld/%@ to update : originator GUID/part: %@/%@ (dict %@)"
- "Found resolved URL %@ for item %@"
- "Host for URL not in ValidSharringURLs so not defaulting FPProviderID"
- "IMDAttachmentQueryStringForIMAttachmentsQuery unknown IMAttachmentsQuery type %lld"
- "IMDCoreSpotlight %s - Got no records from IMDMessageRecordCopyMessagesFromRowIDDescLimit. Stopping indexing"
- "Invalid ResolvedURL: %@"
- "NOT Appending highlight metadata Message: %@ since LP recommened that we do not. URL: %@"
- "No CKBundleIDs found for URL: %@ messageGUID: %@"
- "Not setting FPProviderID: %@ for URL %@ in CSSI. FileName: %@"
- "SELECT * FROM attachment a WHERE a.ck_sync_state == 0 ORDER BY ROWID LIMIT ? "
- "SELECT * FROM attachment a WHERE a.ck_sync_state == 1 AND transfer_state == 0 ORDER BY ROWID DESC LIMIT ? "
- "SELECT ck_sync_state, COUNT(1) AS total_count FROM chat GROUP BY ck_sync_state;"
- "SELECT ck_sync_state, COUNT(1) AS total_count FROM message AS m INNER JOIN chat_message_join AS cmj ON m.ROWID = cmj.message_id GROUP BY m.ck_sync_state;"
- "Setting FPProviderID: %@ for URL %@ in CSSI"
- "Setting default FileProviderID for URL: %@"
- "Since we failed to get LPLinkMetadata URL: %@, %@. Not asking LP's recommendation here."
- "Updating IMMessageItem: %@ from IMMessageItem: %@"
- "_copyNewSearchableIndexesForMessagesWithLastRowID:batchSize:processedMessageCount:timingCollection:"
- "com.apple.IMDPersistenceAgent.IMDSharedWithYouMetadataManager"
- "total_count"
- "tuManagerQueue"

```
