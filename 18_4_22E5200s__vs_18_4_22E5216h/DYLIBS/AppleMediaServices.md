## AppleMediaServices

> `/System/Library/PrivateFrameworks/AppleMediaServices.framework/AppleMediaServices`

```diff

-8.4.17.0.0
-  __TEXT.__text: 0x7ee61c
-  __TEXT.__auth_stubs: 0x4760
-  __TEXT.__objc_methlist: 0x2050c
-  __TEXT.__const: 0x5eab3
+8.4.21.0.0
+  __TEXT.__text: 0x7f6484
+  __TEXT.__auth_stubs: 0x4770
+  __TEXT.__objc_methlist: 0x206bc
+  __TEXT.__const: 0x5eae3
   __TEXT.__dlopen_cstrs: 0x8d3
-  __TEXT.__cstring: 0x2831b
-  __TEXT.__swift5_typeref: 0x3ab9
-  __TEXT.__swift5_reflstr: 0x1d08
+  __TEXT.__cstring: 0x28a0b
+  __TEXT.__swift5_typeref: 0x3abf
+  __TEXT.__swift5_reflstr: 0x1d28
   __TEXT.__swift5_assocty: 0x990
-  __TEXT.__constg_swiftt: 0x2ad0
+  __TEXT.__constg_swiftt: 0x2b04
   __TEXT.__swift5_builtin: 0x208
-  __TEXT.__swift5_fieldmd: 0x23fc
+  __TEXT.__swift5_fieldmd: 0x2418
   __TEXT.__swift5_proto: 0x6c8
-  __TEXT.__swift5_types: 0x2fc
-  __TEXT.__swift_as_entry: 0x408
-  __TEXT.__swift_as_ret: 0x438
-  __TEXT.__swift5_capture: 0x1b14
+  __TEXT.__swift5_types: 0x300
+  __TEXT.__swift_as_entry: 0x404
+  __TEXT.__swift_as_ret: 0x434
+  __TEXT.__swift5_capture: 0x1b84
   __TEXT.__swift5_mpenum: 0x48
   __TEXT.__swift5_protos: 0x7c
-  __TEXT.__oslogstring: 0x2d618
-  __TEXT.__gcc_except_tab: 0x164e4
+  __TEXT.__oslogstring: 0x2e213
+  __TEXT.__gcc_except_tab: 0x16690
   __TEXT.__ustring: 0x1b2
-  __TEXT.__unwind_info: 0x115d0
-  __TEXT.__eh_frame: 0xc9cc
-  __TEXT.__objc_classname: 0x3b6c
-  __TEXT.__objc_methname: 0x4065a
-  __TEXT.__objc_methtype: 0x7109
-  __TEXT.__objc_stubs: 0x2cdc0
-  __DATA_CONST.__got: 0x1878
-  __DATA_CONST.__const: 0xbd90
-  __DATA_CONST.__objc_classlist: 0x1278
+  __TEXT.__unwind_info: 0x11660
+  __TEXT.__eh_frame: 0xc994
+  __TEXT.__objc_classname: 0x3b94
+  __TEXT.__objc_methname: 0x40b47
+  __TEXT.__objc_methtype: 0x7371
+  __TEXT.__objc_stubs: 0x2d0e0
+  __DATA_CONST.__got: 0x1880
+  __DATA_CONST.__const: 0xbe48
+  __DATA_CONST.__objc_classlist: 0x1290
   __DATA_CONST.__objc_catlist: 0xf8
   __DATA_CONST.__objc_protolist: 0x368
   __DATA_CONST.__objc_imageinfo: 0x8
-  __DATA_CONST.__objc_selrefs: 0xe570
+  __DATA_CONST.__objc_selrefs: 0xe648
   __DATA_CONST.__objc_protorefs: 0x180
   __DATA_CONST.__objc_superrefs: 0xc58
   __DATA_CONST.__objc_arraydata: 0x518
-  __AUTH_CONST.__auth_got: 0x23c8
-  __AUTH_CONST.__auth_ptr: 0xa38
-  __AUTH_CONST.__const: 0x2b258
-  __AUTH_CONST.__cfstring: 0x20b60
-  __AUTH_CONST.__objc_const: 0x37aa0
-  __AUTH_CONST.__objc_intobj: 0xca8
+  __AUTH_CONST.__auth_got: 0x23d0
+  __AUTH_CONST.__auth_ptr: 0xaa8
+  __AUTH_CONST.__const: 0x2b3b8
+  __AUTH_CONST.__cfstring: 0x20f80
+  __AUTH_CONST.__objc_const: 0x37be0
+  __AUTH_CONST.__objc_intobj: 0xcc0
   __AUTH_CONST.__objc_arrayobj: 0x108
   __AUTH_CONST.__objc_dictobj: 0x118
-  __AUTH.__objc_data: 0x7768
-  __AUTH.__data: 0x1270
+  __AUTH.__objc_data: 0x78b8
+  __AUTH.__data: 0x12a0
   __AUTH.__thread_vars: 0x30
   __AUTH.__thread_bss: 0x8
-  __DATA.__objc_ivar: 0x17b4
+  __DATA.__objc_ivar: 0x17b0
   __DATA.__data: 0x5740
   __DATA.__bss: 0x9a20
   __DATA.__common: 0xb70
   __DATA_DIRTY.__objc_ivar: 0x658
-  __DATA_DIRTY.__objc_data: 0x54c0
+  __DATA_DIRTY.__objc_data: 0x54c8
   __DATA_DIRTY.__data: 0x1ad8
-  __DATA_DIRTY.__bss: 0x4520
+  __DATA_DIRTY.__bss: 0x4530
   __DATA_DIRTY.__common: 0x78
   - /System/Library/Frameworks/Accounts.framework/Accounts
   - /System/Library/Frameworks/CFNetwork.framework/CFNetwork

   - /System/Library/Frameworks/UserNotifications.framework/UserNotifications
   - /System/Library/PrivateFrameworks/AppSupport.framework/AppSupport
   - /System/Library/PrivateFrameworks/AppleAccount.framework/AppleAccount
-  - /System/Library/PrivateFrameworks/AppleMediaServicesKit.framework/AppleMediaServicesKit
+  - /System/Library/PrivateFrameworks/AppleMediaServicesKitInternal.framework/AppleMediaServicesKitInternal
   - /System/Library/PrivateFrameworks/AssertionServices.framework/AssertionServices
   - /System/Library/PrivateFrameworks/AuthKit.framework/AuthKit
   - /System/Library/PrivateFrameworks/BaseBoard.framework/BaseBoard

   - /usr/lib/swift/libswiftsimd.dylib
   - /usr/lib/swift/libswiftsys_time.dylib
   - /usr/lib/swift/libswiftunistd.dylib
-  Functions: 21958
-  Symbols:   19392
-  CStrings:  20184
+  Functions: 22044
+  Symbols:   19464
+  CStrings:  20309
 
Symbols:
+ _AMSBagKeyPSD2SessionState
+ _AMSBuyParamPropertySecure3dSessionId
+ _OBJC_CLASS_$_AMSCertificateManager
+ _OBJC_CLASS_$__TtC18AppleMediaServices16AMSPSD2EventTask
+ _OBJC_METACLASS_$_ACAccount
+ _OBJC_METACLASS_$_AMSCertificateManager
+ _OBJC_METACLASS_$__TtC18AppleMediaServices16AMSPSD2EventTask
+ _SecCertificateCopyNotValidAfterDate
+ _swift_cvw_allocateGenericValueMetadataWithLayoutString
+ _swift_cvw_assignWithCopy
+ _swift_cvw_assignWithTake
+ _swift_cvw_destroy
+ _swift_cvw_enumFn_getEnumTag
+ _swift_cvw_initStructMetadataWithLayoutString
+ _swift_cvw_initWithCopy
+ _swift_cvw_initWithTake
+ _swift_cvw_initializeBufferWithCopyOfBuffer
+ _swift_cvw_instantiateLayoutString
- _sqlite3_errcode
- _swift_allocateGenericValueMetadataWithLayoutString
- _swift_enumFn_getEnumTag
- _swift_generic_assignWithCopy
- _swift_generic_assignWithTake
- _swift_generic_destroy
- _swift_generic_initWithCopy
- _swift_generic_initWithTake
- _swift_generic_initializeBufferWithCopyOfBuffer
- _swift_generic_instantiateLayoutString
- _swift_initStructMetadataWithLayoutString
CStrings:
+ "\x11\x14\x1b"
+ " (idKey: %@, name: %@, value: %@, storeUUID: %@, expires: %@, modified: %@, lastSync: %@, crossDeviceSync: %@, deleted: %@, serverProvidedAt: %@, changeCounter: %@, changeCause: %@, previousValue: %@)"
+ "%@.%@.%@.%@"
+ "%{public}@ Getting ephemeral account dictionary for non-ephemeral account. account = %@"
+ "%{public}@ [%{public}@] Unknown error: %{public}@"
+ "%{public}@: About to truncate or delete the metrics database %@{public} due to corruption: %{public}@"
+ "%{public}@: Asking delegate to reset database after corruption: %{public}@, error = %{public}@"
+ "%{public}@: Delegate failed to reset database after corruption: %{public}@, error = %{public}@"
+ "%{public}@: Failed to close the AMS Cookie Storage database connection: %{public}@"
+ "%{public}@: Failed to close the AMSStorage database connection: %{public}@"
+ "%{public}@: Failed to close the database connection: %{public}@"
+ "%{public}@: Failed to delete Engagement database after corruption. This is bad! Error = %{public}@"
+ "%{public}@: Failed to reset AMS cookie database after corruption. This is bad! Error = %{public}@"
+ "%{public}@: Failed to reset AMSStorage database after corruption. This is bad! Error = %{public}@"
+ "%{public}@: Failed to reset Engagement database after corruption. This is bad! Error = %{public}@"
+ "%{public}@: Failed to reset metrics database after corruption. This is bad! Error = %{public}@"
+ "%{public}@: Failed to truncate database after corruption: %{public}@, error = %{public}@"
+ "%{public}@: Failed to update AMSStorage database scheme. Success = NO. Error = %@{public}@"
+ "%{public}@: Failed to update Engagement cache database scheme. Success = NO. Error = %{public}@"
+ "%{public}@: Failed to update database scheme. Success = NO. Error = %{public}@"
+ "%{public}@: Fatal Error: Failed to create the AMSStorage database schema: %{public}@."
+ "%{public}@: Fatal Error: Failed to create the database schema: %{public}@"
+ "%{public}@: Ignoring attempt to set a property on ephemeral account. key = %@ | value = %@"
+ "%{public}@: Property directly from ephemeral account. key = %@ | value = %@"
+ "%{public}@: Reading property directly from ephemeral account. key = %@"
+ "%{public}@: Truncating database after corruption: %{public}@, error = %{public}@"
+ "%{public}@: [%{public}@] Added metrics overlay to payload: %@"
+ "%{public}@: [%{public}@] Attesting with expired certificates"
+ "%{public}@ACL lookup failed. Failed to fetch private key"
+ "%{public}@ACL lookup failed. No ACL associated with private key"
+ "%{public}@ACL lookup failed. No attributes associated with private key"
+ "%{public}@About to truncate or delete the AMS metrics identifier store database due to corruption."
+ "%{public}@Creating legacy style attestation"
+ "%{public}@Deleting certificates for account: %{public}@ | purpose = %{public}@"
+ "%{public}@Failed to create access control error = %@"
+ "%{public}@Failed to create attestation. error = %@"
+ "%{public}@Failed to create key pair error = %@"
+ "%{public}@Failed to delete item for label: %{public}@ status: %{public}@"
+ "%{public}@Failed to fetch item for label: %{public}@ status: %{public}@"
+ "%{public}@Failed to find private key in keychain. Will generate."
+ "%{public}@Failed to find/create legacy attestation"
+ "%{public}@Failed to get attesting key. error = %@"
+ "%{public}@Failed to get public key from private key"
+ "%{public}@Failed to save cert for label: %{public}@ status: %{public}@"
+ "%{public}@Failed to save key for label: %{public}@ status: %{public}@"
+ "%{public}@Fetching access control for account: %{public}@ | purpose = %{public}@"
+ "%{public}@Fetching certificates for account: %{public}@ | purpose = %{public}@"
+ "%{public}@Fetching legacy style attestation"
+ "%{public}@Fetching private key for account: %{public}@ | purpose = %{public}@"
+ "%{public}@Fetching private key with context for account: %{public}@ | purpose = %{public}@"
+ "%{public}@Fetching public key failed. Could not fetch private key."
+ "%{public}@Fetching public key failed. Could not fetch public key from private key."
+ "%{public}@Fetching public key for account: %{public}@ | purpose = %{public}@"
+ "%{public}@Legacy attestation does not support style %@"
+ "%{public}@Saving certificates for account: %{public}@ | purpose = %{public}@"
+ "%{public}@Successfully deleted item for label: %{public}@"
+ "%{public}@Successfully fetched item for label: %{public}@"
+ "%{public}@Successfully saved cert for label: %{public}@"
+ "%{public}@Successfully saved key for label: %{public}@"
+ "@40@0:8@16Q24Q32"
+ "AMS Metrics Identifier Store Database Corrupt"
+ "AMSCertificateManager"
+ "AMSEphemeralAccount"
+ "AMSSQLiteConnecton delegate failed to reset the database, but did not return an error"
+ "AMSTTRMetricsidentfiersDatabaseDeletionPromptCount"
+ "Active iTunes account is required for %{public}@"
+ "B24@0:8o^@16"
+ "B32@0:8@16o^@24"
+ "B40@0:8@\"AMSSQLiteConnection\"16@\"NSError\"24o^@32"
+ "B40@0:8@16@24o^@32"
+ "B40@0:8q16@?24^@32"
+ "Database Reset Error"
+ "Error Finalizing Prepared Statement"
+ "Failed to Begin Transaction After I/O Error"
+ "Failed to Close Database"
+ "Failed to Truncate Database"
+ "Frictionless Flow: Executed replay buy request, received this response from SE: "
+ "Frictionless Flow: Received replay hook from CUI, about to replay the buy"
+ "Metrics identifier store failure"
+ "MinimalAMSURLSession"
+ "PSD2_AMS_RESUME_3D_STEP_UP"
+ "Please file a Radar."
+ "Request finished with error: "
+ "Request finished with status code: "
+ "Sending Initial PSD2 Event"
+ "Sending Retry Result PSD2 Event"
+ "Skipping sending PSD2 Event. Action was not a retry."
+ "Skipping sending PSD2 Event. No secure 3d session id"
+ "Statement Execution Failed, Database Corrupt"
+ "Statement Execution Failed, I/O Error"
+ "Statement Execution Failed, Unknown Error"
+ "Statement execution Timed Out"
+ "T@\"NSNumber\",&,N,V_hostProcessIdentifier"
+ "TB,N,V_shouldEmitPreviousUserId"
+ "TSDataSyncMetrics"
+ "The SQLite database backing AMS metrics identifier store appears to be corrupt and will be deleted. This might cause unexpected rotations of Katana IDs."
+ "Unable to Open Database Before Truncating"
+ "Unable to Truncate Database"
+ "Unable to Truncate Read-Only Database"
+ "Unable to determine cachesURL while removing database."
+ "Unable to determine cachesURL."
+ "Unable to determine dataVaultURL while removing database."
+ "Unable to determine dataVaultURL."
+ "[%@] %@ in %@: %@ container is corrupt"
+ "^v32@0:8@16Q24"
+ "^v40@0:8@16Q24@32"
+ "^{__SecAccessControl=}32@0:8@16Q24"
+ "^{__SecKey={__CFRuntimeBase=QAQ}^{__SecKeyDescriptor}^v}32@0:8@16Q24"
+ "^{__SecKey={__CFRuntimeBase=QAQ}^{__SecKeyDescriptor}^v}40@0:8@16@24Q32"
+ "^{__SecKey={__CFRuntimeBase=QAQ}^{__SecKeyDescriptor}^v}40@0:8@16Q24Q32"
+ "_TtC18AppleMediaServices16AMSPSD2EventTask"
+ "_baseKeychainQueryDictionaryWithLabel:"
+ "_closeDueToError:error:"
+ "_deleteItemForLabel:type:"
+ "_generateCertificateChainStringsForAccount:options:error:"
+ "_generateLegacyAttestationKeyPairWithAccount:style:forPurpose:"
+ "_hostProcessIdentifier"
+ "_itemForLabel:type:"
+ "_itemForLabel:type:additionalQueryParameters:"
+ "_labelForAccount:itemType:purpose:"
+ "_performResetAfterCorruptionError:error:"
+ "_resetAfterCorruptionError:error:"
+ "_resetAfterIOError:error:"
+ "_saveCertificate:forLabel:"
+ "_saveKey:forLabel:"
+ "_shouldEmitPreviousUserId"
+ "accessControlForAccount:forSignaturePurpose:"
+ "attestationWithAccount:options:error:"
+ "cert.intermediate"
+ "cert.leaf"
+ "certificatesForAccount:forSignaturePurpose:"
+ "connection:needsResetForCorruptionError:error:"
+ "deleteCertificatesForAccount:forSignaturePurpose:"
+ "extended"
+ "getSubscriptionEntitlementsForSegment:ignoreCaches:isBackground:requestingBundleId:withCacheInfoResultHandler:"
+ "hostProcessIdentifier"
+ "initWithActivity:"
+ "isExpiredForCertificates:"
+ "kHostProcessIdentifier"
+ "legacyAttestationWithAccount:style:forPurpose:"
+ "migrateToVersion:usingBlock:error:"
+ "multiUserIdentifier"
+ "performClientCertChainRequestWithAccount:"
+ "performClientCertChainRequestWithAccount:options:completion:"
+ "populateDictionary:shouldEmitDiagnosticFields:shouldEmitPreviousUserId:"
+ "primary"
+ "privateKeyForAccount:forSignaturePurpose:"
+ "privateKeyForAccount:withContext:forSignaturePurpose:"
+ "psd2SessionState"
+ "publicKeyForAccount:forSignaturePurpose:"
+ "pushPayload:metricsOverlayForType:"
+ "removeDatabaseAtURL:error:"
+ "removeDatabaseForCachePath:error:"
+ "removeDatabaseForDataVaultPath:error:"
+ "saveCertificatesForAccount:leafCertificate:intermediateCertificate:privateKey:forSignaturePurpose:"
+ "secure3dSessionId"
+ "sendInitialPSD2EventWithAction:bag:"
+ "sendRetryResultPSD2EventWithAction:result:bag:"
+ "setHostProcessIdentifier:"
+ "setShouldEmitPreviousUserId:"
+ "setTtrMetricsidentfiersDatabaseDeletionPromptCount:"
+ "sharedRegexCache"
+ "shouldCacheRegularExpressions"
+ "shouldEmitPreviousUserId"
+ "shouldUseAccountSpecificCertificatesForAccount:"
+ "truncateWithError:"
+ "ttrMetricsidentfiersDatabaseDeletionPromptCount"
+ "v32@0:8@16B24B28"
+ "v32@0:8^{__SecCertificate=}16@24"
+ "v32@0:8^{__SecKey={__CFRuntimeBase=QAQ}^{__SecKeyDescriptor}^v}16@24"
+ "v40@0:8@\"ACAccount\"16@\"AMSKeychainOptions\"24@?<v@?@\"NSArray\"@\"NSError\">32"
+ "v56@0:8@16^{__SecCertificate=}24^{__SecCertificate=}32^{__SecKey={__CFRuntimeBase=QAQ}^{__SecKeyDescriptor}^v}40Q48"
+ "xpPreviousUserId"
+ "yyyy-MM-dd'T'HH:mm:ssZZZZZ"
- "\x11\x14\x1a"
- "\x1c"
- " (idKey: %@, name: %@, value: %@, storeUUID: %@, expires: %@, modified: %@, lastSync: %@, crossDeviceSync: %@, deleted: %@, serverProvidedAt: %@, changeCounter: %@, changeCause: %@, previousValue: %@, rotationPeriod: %@)"
- "%{public}@: About to truncate or delete the metrics database %@{public} due to corruption"
- "%{public}@: Asking delegate to reset database after corruption: %{public}@"
- "%{public}@: Failed to close the AMS Cookie Storage database connection"
- "%{public}@: Failed to close the AMSStorage database connection"
- "%{public}@: Failed to close the database connection"
- "%{public}@: Failed to reset AMS cookie database after corruption. This is bad!"
- "%{public}@: Failed to reset AMSStorage database after corruption. This is bad!"
- "%{public}@: Failed to reset Engagement database after corruption. This is bad!"
- "%{public}@: Failed to reset database after corruption. This is bad!"
- "%{public}@: Failed to update AMSStorage database scheme. Success = NO"
- "%{public}@: Failed to update Engagement cache database scheme. Success = NO"
- "%{public}@: Failed to update database scheme. Success = NO"
- "%{public}@: Fatal Error: Failed to create the AMSStorage database schema."
- "%{public}@: Fatal Error: Failed to create the database schema"
- "%{public}@: Truncating database after corruption: %{public}@"
- "B24@0:8@\"AMSSQLiteConnection\"16"
- "B32@0:8q16@?24"
- "PreviousValue"
- "RotationPeriod"
- "T@\"AMSURLSession\",N,R"
- "T@\"NSError\",R,C,N"
- "T@\"NSMutableDictionary\",&,N,V_regexCache"
- "T@\"NSMutableDictionary\",R,N,V_regexCache"
- "T@\"NSNumber\",C,N,V_rotationPeriod"
- "_close"
- "_generateCertificateChainStringsForOptions:error:"
- "_performResetAfterCorruptionError"
- "_regexCache"
- "_resetAfterCorruptionError"
- "_resetAfterIOError"
- "_rotationPeriod"
- "connectionNeedsResetForCorruption:"
- "currentError"
- "getSubscriptionEntitlementsForSegment:ignoreCaches:requestingBundleId:withCacheInfoResultHandler:"
- "migrateToVersion:usingBlock:"
- "performClientCertChainRequestWithOptions:completion:"
- "populateDictionary:shouldEmitDiagnosticFields:"
- "regexCache"
- "removeDatabaseAtURL:"
- "removeDatabaseForCachePath:"
- "removeDatabaseForDataVaultPath:"
- "rotationPeriod"
- "setRegexCache:"
- "setRotationPeriod:"
- "truncate"
- "v32@0:8@\"AMSKeychainOptions\"16@?<v@?@\"NSArray\"@\"NSError\">24"

```
