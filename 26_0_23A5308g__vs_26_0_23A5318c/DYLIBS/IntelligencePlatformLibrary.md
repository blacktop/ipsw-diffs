## IntelligencePlatformLibrary

> `/System/Library/PrivateFrameworks/IntelligencePlatformLibrary.framework/IntelligencePlatformLibrary`

```diff

-243.0.0.0.0
+245.0.0.0.0
   __TEXT.__text: 0x4da04c
   __TEXT.__auth_stubs: 0x18f0
   __TEXT.__objc_methlist: 0x11e14

   __TEXT.__swift5_types: 0x1224
   __TEXT.__swift5_reflstr: 0x1233a
   __TEXT.__swift5_assocty: 0x3308
-  __TEXT.__cstring: 0x68413
+  __TEXT.__cstring: 0x68723
   __TEXT.__oslogstring: 0x19c
   __TEXT.__swift5_proto: 0x58c8
   __TEXT.__swift5_capture: 0x35f0

   - /usr/lib/swift/libswift_Concurrency.dylib
   - /usr/lib/swift/libswift_DarwinFoundation1.dylib
   - /usr/lib/swift/libswiftos.dylib
-  UUID: BA9F4894-80E5-3A45-8CEE-1CB586B144F6
+  UUID: A5FD5A7C-E632-3BA3-872D-3D7CFF0E5DE3
   Functions: 48712
   Symbols:   45490
   CStrings:  13379
CStrings:
+ "355b1a0e8fccbac869262318a11526c6dee570f3419af3808215428ea0b846b6"
+ "65effd5f-0ebc-4484-b36f-545a6006c76f"
+ "{\"configHash\": \"355b1a0e8fccbac869262318a11526c6dee570f3419af3808215428ea0b846b6\", \"dependencies\": [\"WalletOrderFields\", \"WalletTrackedOrderFields\", \"WalletOrder\", \"WalletOrderEmail\", \"WalletOrderPayment\", \"WalletOrderTransaction\", \"WalletOrderShipmentFullFillmentInfo\", \"WalletOrderPerson\"], \"dependents\": [\"WalletCascadeInsert\"], \"deployment\": [\"production\"], \"featureFlag\": \"OrionSQL\", \"legacyName\": \"WalletOrderExtractedView\", \"name\": \"WalletOrderExtractedView\", \"platforms\": {\"iOS\": \"18.0\"}, \"sql\": {\"update\": \"WITH WalletOrderFields AS (\\n  SELECT\\n    wof.*\\n  FROM\\n    (\\n      SELECT DISTINCT\\n        identifier\\n      FROM\\n        \\\"WalletPaymentsCommerce.Internal.WalletOrder\\\"\\n      WHERE\\n        referenceEntityIdType = 'emailIdentifier'\\n    ) AS EmailLinkedOrder\\n    INNER JOIN \\\"WalletPaymentsCommerce.Internal.WalletOrderFields\\\" wof ON EmailLinkedOrder.identifier = wof.identifier\\n),\\nWalletEmailOrder AS (\\n  SELECT\\n    subject,\\n    orderNumber,\\n    referenceId\\n  FROM\\n    \\\"WalletPaymentsCommerce.Internal.WalletOrder\\\"\\n  WHERE\\n    referenceEntityIdType = 'emailIdentifier'\\n),\\nWalletOrderMerchantListByEmail AS (\\n  SELECT\\n    ROW_NUMBER() OVER (\\n      PARTITION BY WalletEmailOrder.subject\\n      ORDER BY\\n        emailSentDate ASC\\n    ) as rn,\\n    WalletEmailOrder.subject,\\n    origOrderNumber as orderNumber,\\n    origMerchantName AS merchantName,\\n    emailSentDate\\n  FROM\\n    WalletEmailOrder\\n    LEFT JOIN \\\"WalletPaymentsCommerce.Internal.WalletOrderEmail\\\" we ON WalletEmailOrder.referenceId = we.subject\\n),\\nWalletTrackedOrderFields AS (\\n  SELECT\\n    subject,\\n    trkOrderNumber as orderNumber,\\n    trkMerchantName as merchantName,\\n    trkOrderStatus as orderStatus,\\n    earliestEmailDateSent as earliestEmailDateSent,\\n    displayNameUpdateDate ,\\n    orderStatusUpdateDate\\n  FROM\\n    \\\"WalletPaymentsCommerce.Internal.WalletTrackedOrderFields\\\"\\n),\\nWalletOrderMerchantListUnion AS (\\n    SELECT subject , orderNumber, merchantName, emailSentDate FROM WalletOrderMerchantListByEmail\\n    UNION\\n    SELECT subject, orderNumber, merchantName, displayNameUpdateDate as emailSentDate FROM\\n        WalletTrackedOrderFields WHERE displayNameUpdateDate IS NOT NULL AND displayNameUpdateDate!=''\\n),\\nWalletOrderEmailEarliestDateList AS (\\n    SELECT subject , emailSentDate AS earliestEmailDateSent FROM WalletOrderMerchantListByEmail\\n    UNION\\n    SELECT subject, earliestEmailDateSent FROM walletTrackedOrderFields WHERE earliestEmailDateSent IS NOT NULL AND earliestEmailDateSent!=''\\n),\\nWalletEmailsUnionRanked AS  (SELECT *,  ROW_NUMBER() OVER (\\n      PARTITION BY subject\\n      ORDER BY\\n        earliestEmailDateSent ASC\\n    ) as rn FROM WalletOrderEmailEarliestDateList),\\nWalletEmailEarliestDateFinal AS (\\n    SELECT subject, earliestEmailDateSent FROM WalletEmailsUnionRanked WHERE rn =1 ),\\nWalletOrderMerchantList AS (\\n    SELECT\\n      ROW_NUMBER() OVER (\\n        PARTITION BY subject\\n        ORDER BY\\n          emailSentDate ASC\\n      ) as rn,\\n      subject,\\n      orderNumber,\\n      merchantName,\\n      emailSentDate AS displayNameUpdateDate FROM\\n    WalletOrderMerchantListUnion\\n),\\nWalletOrderStatusRanked AS (\\n  SELECT\\n    WalletEmailOrder.subject,\\n    orderNumber,\\n    CASE\\n      WHEN emailType = '1' THEN '1'\\n      WHEN emailType = '3' THEN '3'\\n      WHEN emailType = '4' THEN '4'\\n      ELSE NULL\\n    END AS emailOrderStatus,\\n    emailSentDate\\n  FROM\\n    WalletEmailOrder\\n    LEFT JOIN \\\"WalletPaymentsCommerce.Internal.WalletOrderEmail\\\" we ON WalletEmailOrder.referenceId = we.subject\\n    UNION\\n  SELECT subject, orderNumber, orderStatus AS emailOrderStatus, orderStatusUpdateDate AS emailSentDate FROM WalletTrackedOrderFields\\n),\\nWalletOrderStatusRankedList AS (\\n  SELECT\\n    *,\\n    ROW_NUMBER() OVER (\\n      PARTITION BY WalletOrderStatusRanked.subject\\n      ORDER BY\\n        emailSentDate DESC\\n    ) as rn\\n  FROM\\n    WalletOrderStatusRanked\\n  where\\n    emailOrderStatus IS NOT NULL\\n),\\nWalletOrderStatusFinal AS (\\n  SELECT\\n    subject,\\n    orderNumber,\\n    emailOrderStatus AS orderStatus,\\n    emailSentDate AS orderStatusUpdateDate\\n  FROM\\n    WalletOrderStatusRankedList\\n  WHERE\\n    rn = 1\\n),\\nWalletOrderMerchant AS (\\n  SELECT\\n    subject,\\n    merchantName,\\n    orderNumber,\\n    JSON_OBJECT('displayName', merchantName,\\n     'displayNameUpdateDate',  CAST(displayNameUpdateDate AS REAL)) AS merchantJson\\n  FROM\\n    WalletOrderMerchantList\\n  WHERE\\n    rn = 1\\n),\\nWalletPersonOrder AS (\\n  SELECT\\n    subject,\\n    orderNumber,\\n    referenceId\\n  FROM\\n    walletOrder\\n  WHERE\\n    referenceEntityIdType = 'customerIdentifier'\\n),\\nWalletPersonOrderJson AS (\\n  SELECT\\n    WalletPersonOrder.subject,\\n    JSON_OBJECT(\\n      'fullName',\\n      name,\\n      'phoneNumber',\\n      phone,\\n      'emailAddress',\\n      email,\\n      'billingAddress',\\n      JSON_OBJECT(\\n        'street',\\n        street,\\n        'city',\\n        city,\\n        'state',\\n        state,\\n        'country',\\n        country,\\n        'postalCode',\\n        postal,\\n        'rawAddress',\\n        rawAddress\\n      )\\n    ) AS personJson\\n  FROM\\n    WalletPersonOrder\\n    LEFT JOIN \\\"WalletPaymentsCommerce.Internal.WalletOrderPerson\\\" wop ON WalletPersonOrder.referenceId = wop.subject\\n),\\nWalletPymOrder AS (\\n  SELECT\\n    subject,\\n    orderNumber,\\n    referenceId\\n  FROM\\n    \\\"WalletPaymentsCommerce.Internal.WalletOrder\\\"\\n  WHERE\\n    referenceEntityIdType = 'paymentIdentifier'\\n),\\nWalletTrxOrder AS (\\n  SELECT\\n    subject,\\n    orderNumber,\\n    referenceId\\n  FROM\\n    \\\"WalletPaymentsCommerce.Internal.WalletOrder\\\"\\n  WHERE\\n    referenceEntityIdType = 'transactionIdentifier'\\n),\\nWalletPymTbl AS (\\n  SELECT\\n    WalletPymOrder.subject,\\n    orderNumber,\\n    totalAmount,\\n    currencyCode,\\n    ROW_NUMBER() OVER (\\n      PARTITION BY WalletPymOrder.subject\\n      ORDER BY\\n        totalAmount DESC\\n    ) AS rn\\n  FROM\\n    WalletPymOrder\\n    LEFT JOIN \\\"WalletPaymentsCommerce.Internal.WalletOrderPayment\\\" wop ON WalletPymOrder.referenceId = wop.subject\\n),\\nWalletPymCol AS (\\n  SELECT\\n    subject,\\n    orderNumber,\\n    totalAmount,\\n    currencyCode\\n  FROM\\n    WalletPymTbl\\n  where\\n    rn = 1\\n),\\nWalletTrxCol AS (\\n  SELECT DISTINCT\\n    WalletTrxOrder.subject,\\n    JSON_GROUP_ARRAY(\\n      JSON_OBJECT(\\n        'amount',\\n        totalAmount,\\n        'isoCurrencyCode',\\n        currencyCode,\\n        'transactionIdenifier',\\n        trxId,\\n        'paymentMethod',\\n        JSON_OBJECT(\\n          'lastFourDigits',\\n          accountLastFourDigits,\\n          'displayName',\\n          accountInstitution\\n        )\\n      )\\n    ) AS trxInfo\\n  FROM\\n    WalletTrxOrder\\n    LEFT JOIN \\\"WalletPaymentsCommerce.Internal.WalletOrderTransaction\\\" wot ON WalletTrxOrder.referenceId = wot.subject\\n  WHERE\\n    currencyCode IS NOT NULL\\n    OR totalAmount IS NOT NULL\\n    OR accountInstitution IS NOT NULL\\n    OR accountLastFourDigits IS NOT NULL\\n  GROUP BY\\n    WalletTrxOrder.subject\\n),\\nWalletPymJson AS (\\n  SELECT\\n    WalletPymCol.subject,\\n    JSON_OBJECT(\\n      'totalAmount',\\n      totalAmount,\\n      'totalIsoCurrencyCode',\\n      currencyCode,\\n      'transactions',\\n      json_extract(trxInfo, '$')\\n    ) AS orderPayment\\n  FROM\\n    WalletPymCol\\n    LEFT JOIN WalletTrxCol ON WalletPymCol.subject = WalletTrxCol.subject\\n),\\nWalletShipmentOrder AS (\\n  SELECT\\n    subject,\\n    orderNumber,\\n    referenceId\\n  FROM\\n    \\\"WalletPaymentsCommerce.Internal.WalletOrder\\\"\\n  WHERE\\n    referenceEntityIdType = 'shipmentFullFillmentIdentifier'\\n),\\nWalletDedupeShipment AS (\\n  SELECT DISTINCT\\n    WalletShipmentOrder.subject AS identifierOrder,\\n    WalletShipmentOrder.orderNumber,\\n    wosfi.*\\n  FROM\\n    WalletShipmentOrder\\n    LEFT JOIN \\\"WalletPaymentsCommerce.Internal.WalletOrderShipmentFullFillmentInfo\\\" wosfi ON WalletShipmentOrder.referenceId = wosfi.subject\\n),\\nWalletShipmentOrderByEmail AS (\\n  SELECT\\n    WalletDedupeShipment.subject AS orderIdentifier,\\n    *,\\n    ROW_NUMBER() OVER (\\n      PARTITION BY orderNumber,\\n      trackingNumber\\n      ORDER BY\\n        fullfillmentUpdateDate DESC,\\n        emailSentDate DESC\\n    ) AS rn\\n  FROM\\n    WalletDedupeShipment\\n    LEFT JOIN \\\"WalletPaymentsCommerce.Internal.WalletOrderEmail\\\" we ON WalletDedupeShipment.emailIdentifier = we.subject\\n),\\nWalletShipmentWithPilledValues AS (\\n  SELECT\\n    s1.*,\\n    COALESCE(s1.carrierName,\\n      (SELECT s2.carrierName FROM WalletShipmentOrderByEmail s2\\n       WHERE s2.orderNumber = s1.orderNumber AND\\n             (s1.trackingNumber IS NULL OR s2.trackingNumber = s1.trackingNumber) AND\\n             s2.carrierName IS NOT NULL\\n       ORDER BY s2.fullfillmentUpdateDate DESC, s2.emailSentDate DESC LIMIT 1)) AS filled_carrierName,\\n    COALESCE(s1.trackingNumber,\\n      (SELECT s2.trackingNumber FROM WalletShipmentOrderByEmail s2\\n       WHERE s2.orderNumber = s1.orderNumber AND\\n             s2.trackingNumber IS NOT NULL\\n       ORDER BY s2.fullfillmentUpdateDate DESC, s2.emailSentDate DESC LIMIT 1)) AS filled_trackingNumber,\\n    COALESCE(s1.shippingMethod,\\n      (SELECT s2.shippingMethod FROM WalletShipmentOrderByEmail s2\\n       WHERE s2.orderNumber = s1.orderNumber AND\\n             (s1.trackingNumber IS NULL OR s2.trackingNumber = s1.trackingNumber) AND\\n             s2.shippingMethod IS NOT NULL\\n       ORDER BY s2.fullfillmentUpdateDate DESC, s2.emailSentDate DESC LIMIT 1)) AS filled_shippingMethod,\\n    COALESCE(s1.shippingStatus,\\n      (SELECT s2.shippingStatus FROM WalletShipmentOrderByEmail s2\\n       WHERE s2.orderNumber = s1.orderNumber AND\\n             (s1.trackingNumber IS NULL OR s2.trackingNumber = s1.trackingNumber) AND\\n             s2.shippingStatus IS NOT NULL\\n       ORDER BY s2.fullfillmentUpdateDate DESC, s2.emailSentDate DESC LIMIT 1)) AS filled_shippingStatus,\\n    COALESCE(s1.shippingDate,\\n      (SELECT s2.shippingDate FROM WalletShipmentOrderByEmail s2\\n       WHERE s2.orderNumber = s1.orderNumber AND\\n             (s1.trackingNumber IS NULL OR s2.trackingNumber = s1.trackingNumber) AND\\n             s2.shippingDate IS NOT NULL\\n       ORDER BY s2.fullfillmentUpdateDate DESC, s2.emailSentDate DESC LIMIT 1)) AS filled_shippingDate,\\n    COALESCE(s1.estimatedDeliveryStartDate,\\n      (SELECT s2.estimatedDeliveryStartDate FROM WalletShipmentOrderByEmail s2\\n       WHERE s2.orderNumber = s1.orderNumber AND\\n             (s1.trackingNumber IS NULL OR s2.trackingNumber = s1.trackingNumber) AND\\n             s2.estimatedDeliveryStartDate IS NOT NULL\\n       ORDER BY s2.fullfillmentUpdateDate DESC, s2.emailSentDate DESC LIMIT 1)) AS filled_estimatedDeliveryStartDate,\\n    COALESCE(s1.estimatedDeliveryStartTime,\\n      (SELECT s2.estimatedDeliveryStartTime FROM WalletShipmentOrderByEmail s2\\n       WHERE s2.orderNumber = s1.orderNumber AND\\n             (s1.trackingNumber IS NULL OR s2.trackingNumber = s1.trackingNumber) AND\\n             s2.estimatedDeliveryStartTime IS NOT NULL\\n       ORDER BY s2.fullfillmentUpdateDate DESC, s2.emailSentDate DESC LIMIT 1)) AS filled_estimatedDeliveryStartTime,\\n    COALESCE(s1.estimatedDeliveryEndDate,\\n      (SELECT s2.estimatedDeliveryEndDate FROM WalletShipmentOrderByEmail s2\\n       WHERE s2.orderNumber = s1.orderNumber AND\\n             (s1.trackingNumber IS NULL OR s2.trackingNumber = s1.trackingNumber) AND\\n             s2.estimatedDeliveryEndDate IS NOT NULL\\n       ORDER BY s2.fullfillmentUpdateDate DESC, s2.emailSentDate DESC LIMIT 1)) AS filled_estimatedDeliveryEndDate,\\n    COALESCE(s1.estimatedDeliveryEndTime,\\n      (SELECT s2.estimatedDeliveryEndTime FROM WalletShipmentOrderByEmail s2\\n       WHERE s2.orderNumber = s1.orderNumber AND\\n             (s1.trackingNumber IS NULL OR s2.trackingNumber = s1.trackingNumber) AND\\n             s2.estimatedDeliveryEndTime IS NOT NULL\\n       ORDER BY s2.fullfillmentUpdateDate DESC, s2.emailSentDate DESC LIMIT 1)) AS filled_estimatedDeliveryEndTime,\\n    COALESCE(s1.deliveryDate,\\n      (SELECT s2.deliveryDate FROM WalletShipmentOrderByEmail s2\\n       WHERE s2.orderNumber = s1.orderNumber AND\\n             (s1.trackingNumber IS NULL OR s2.trackingNumber = s1.trackingNumber) AND\\n             s2.deliveryDate IS NOT NULL\\n       ORDER BY s2.fullfillmentUpdateDate DESC, s2.emailSentDate DESC LIMIT 1)) AS filled_deliveryDate,\\n    COALESCE(s1.deliveryTime,\\n      (SELECT s2.deliveryTime FROM WalletShipmentOrderByEmail s2\\n       WHERE s2.orderNumber = s1.orderNumber AND\\n             (s1.trackingNumber IS NULL OR s2.trackingNumber = s1.trackingNumber) AND\\n             s2.deliveryTime IS NOT NULL\\n       ORDER BY s2.fullfillmentUpdateDate DESC, s2.emailSentDate DESC LIMIT 1)) AS filled_deliveryTime,\\n    COALESCE(s1.personIdentifier,\\n         (SELECT s2.personIdentifier FROM WalletShipmentOrderByEmail s2\\n          WHERE s2.orderNumber = s1.orderNumber AND\\n                (s1.trackingNumber IS NULL OR s2.trackingNumber = s1.trackingNumber) AND\\n                s2.personIdentifier IS NOT NULL\\n          ORDER BY s2.fullfillmentUpdateDate DESC, s2.emailSentDate DESC LIMIT 1)) AS filled_personIdentifier\\n  FROM WalletShipmentOrderByEmail s1\\n),\\nWalletShipmentFilledRanked AS (\\n SELECT\\n    s1.*,\\n   ROW_NUMBER() OVER (\\n      PARTITION BY orderNumber,\\n      filled_trackingNumber\\n      ORDER BY\\n        fullfillmentUpdateDate DESC,\\n        emailSentDate DESC\\n    ) AS mrn\\nFROM  WalletShipmentWithPilledValues s1\\n),\\nWalletShippingRecepientOrderJson AS (\\n    SELECT\\n      WalletShipmentFilledRanked.subject,\\n      *,\\n      JSON_OBJECT(\\n        'fullName',\\n        name,\\n        'phoneNumber',\\n        phone,\\n        'emailAddress',\\n        email,\\n        'address',\\n        JSON_OBJECT(\\n          'street',\\n          street,\\n          'city',\\n          city,\\n          'state',\\n          state,\\n          'country',\\n          country,\\n          'postalCode',\\n          postal,\\n          'rawAddress',\\n          rawAddress\\n        )\\n      ) AS shippingRecepientJson\\n    FROM\\n      WalletShipmentFilledRanked\\n      LEFT JOIN \\\"WalletOrderPerson\\\" wop ON wop.subject = WalletShipmentFilledRanked.filled_personIdentifier\\n      WHERE rn=1\\n),\\nWalletShipmentJson AS (\\n    SELECT\\n      WalletShipmentFilledRanked.identifierOrder AS identifierOrder,\\n      WalletShipmentFilledRanked.orderNumber,\\n      JSON_GROUP_ARRAY(\\n        JSON_OBJECT(\\n          'carrierName',\\n          WalletShipmentFilledRanked.filled_carrierName,\\n          'trackingNumber',\\n          WalletShipmentFilledRanked.filled_trackingNumber,\\n          'shippingMethod',\\n          WalletShipmentFilledRanked.filled_shippingMethod,\\n          'status',\\n          CAST(\\n            WalletShipmentFilledRanked.filled_shippingStatus AS INTEGER\\n          ),\\n          'shippingDate',\\n          WalletShipmentFilledRanked.filled_shippingDate,\\n          'estimatedDeliveryStartDate',\\n          WalletShipmentFilledRanked.filled_estimatedDeliveryStartDate,\\n          'estimatedDeliveryStartTime',\\n          WalletShipmentFilledRanked.filled_estimatedDeliveryStartTime,\\n          'estimatedDeliveryEndDate',\\n          WalletShipmentFilledRanked.filled_estimatedDeliveryEndDate,\\n          'estimatedDeliveryEndTime',\\n          WalletShipmentFilledRanked.filled_estimatedDeliveryEndTime,\\n          'deliveryDate',\\n          WalletShipmentFilledRanked.filled_deliveryDate,\\n          'deliveryTime',\\n          WalletShipmentFilledRanked.filled_deliveryTime,\\n          'fulfillmentUpdateDate',\\n          (\\n            CASE\\n              WHEN WalletShipmentFilledRanked.emailSentDate IS NULL THEN CAST(\\n                WalletShipmentFilledRanked.fullfillmentUpdateDate AS REAL\\n              )\\n              WHEN WalletShipmentFilledRanked.fullfillmentUpdateDate IS NULL THEN CAST(\\n                WalletShipmentFilledRanked.emailSentDate AS REAL\\n              )\\n              WHEN CAST(\\n                WalletShipmentFilledRanked.emailSentDate AS REAL\\n              ) > CAST(\\n                WalletShipmentFilledRanked.fullfillmentUpdateDate AS REAL\\n              ) THEN CAST(\\n                WalletShipmentFilledRanked.emailSentDate AS REAL\\n              )\\n              ELSE CAST(\\n                WalletShipmentFilledRanked.fullfillmentUpdateDate AS REAL\\n              )\\n            END\\n          ),\\n          'shippingRecipient',\\n          json_extract(\\n            WalletShippingRecepientOrderJson.shippingRecepientJson,\\n            '$'\\n          )\\n        )\\n      ) AS shipmentJson\\n    FROM\\n      WalletShipmentFilledRanked\\n      LEFT JOIN WalletShippingRecepientOrderJson ON WalletShippingRecepientOrderJson.orderIdentifier = WalletShipmentFilledRanked.orderIdentifier\\n    WHERE\\n      WalletShipmentFilledRanked.mrn = 1\\n      GROUP BY\\n    WalletShipmentFilledRanked.identifierOrder\\n),\\nWalletEmailShipping AS (\\n  SELECT\\n    shippingStatus,\\n    trackingNumber,\\n    carrierName,\\n    we.subject\\n  FROM\\n    \\\"WalletPaymentsCommerce.Internal.WalletOrderShipmentFullFillmentInfo\\\" wosfi\\n    LEFT JOIN \\\"WalletPaymentsCommerce.Internal.WalletOrderEmail\\\" we ON wosfi.emailIdentifier = we.subject\\n),\\nWalletEmailOrderJson AS (\\n  SELECT\\n    WalletEmailOrder.subject,\\n    orderNumber,\\n    JSON_GROUP_ARRAY(\\n      JSON_OBJECT(\\n        'emailType',\\n        CAST(emailType AS INTEGER),\\n        'emailMetadata',\\n        JSON_OBJECT(\\n          'messageID',\\n          messageID,\\n          'senderDomain',\\n          senderDomain,\\n          'replyToEmailAddress',\\n          emailReplyTo,\\n          'subject',\\n          emailSubject,\\n          'toEmailAddress',\\n          emailTo,\\n          'fromEmailAddress',\\n          emailFrom,\\n          'toDisplayName',\\n          emailToDisplay,\\n          'fromDisplayName',\\n          emailFromDisplay,\\n          'replyToDisplayName',\\n          emailReplyToDisplay,\\n          'dateSent',\\n          CAST(emailSentDate AS REAL)\\n        ),\\n        'orderDetails',\\n        JSON_OBJECT(\\n          'orderNumber',\\n          origOrderNumber,\\n          'merchant',\\n            JSON_OBJECT('displayName', origMerchantName),\\n          'shippingDetails',\\n          JSON_OBJECT(\\n            'status',\\n            CAST(shippingStatus AS INTEGER),\\n            'trackingNumber',\\n            origTrackingNumber,\\n            'carrierName',\\n            carrierName\\n          )\\n        ),\\n        'spotlightUniqueIdentifier',\\n        spotlightUniqueIdentifier,\\n        'spotlightDomainIdentifier',\\n        spotlightDomainIdentifier\\n      )\\n    ) AS emailArr\\n  FROM\\n    WalletEmailOrder\\n    LEFT JOIN \\\"WalletPaymentsCommerce.Internal.WalletOrderEmail\\\" we ON WalletEmailOrder.referenceId = we.subject\\n    LEFT JOIN \\\"WalletEmailShipping\\\" wes ON walletEmailOrder.referenceId = wes.subject\\n  GROUP BY\\n    WalletEmailOrder.subject\\n  ORDER BY emailSentDate DESC\\n)\\nSELECT DISTINCT\\n  WalletOrderFields.subject,\\n  'md:' || WalletOrderFields.subject AS identifier,\\n  WalletOrderFields.orderNumber AS orderNumber,\\n  JSON_OBJECT(\\n    'orderNumber',\\n    WalletOrderMerchant.orderNumber,\\n    'orderDate',\\n    WalletOrderFields.orderDate,\\n    'orderIdentifier',\\n    WalletOrderFields.orderIdentifier,\\n    'orderTypeIdentifier',\\n    WalletOrderFields.orderTypeIdentifier,\\n    'trackedOrderIdentifier',\\n    WalletOrderFields.trackedOrderIdentifier,\\n    'orderUpdateDate',\\n    CAST(WalletOrderFields.orderUpdateDate AS REAL),\\n    'orderEmails',\\n    json_extract(emailArr, '$'),\\n    'payment',\\n    json_extract(WalletPymJson.orderPayment, '$'),\\n    'shippingFulfillments',\\n    json_extract(WalletShipmentJson.shipmentJson, '$'),\\n    'merchant',\\n    json_extract(WalletOrderMerchant.merchantJson, '$'),\\n    'customer',\\n    json_extract(WalletPersonOrderJson.personJson, '$'),\\n    'orderStatus',\\n    CAST(WalletOrderStatusFinal.orderStatus AS INTEGER),\\n    'orderStatusUpdateDate',\\n    CAST(WalletOrderStatusFinal.orderStatusUpdateDate AS REAL),\\n    'earliestEmailDateSent',\\n    CAST(WalletEmailEarliestDateFinal.earliestEmailDateSent AS REAL)\\n  ) AS orderJson\\nFROM\\n  WalletOrderFields\\n  LEFT JOIN WalletEmailOrderJson ON WalletOrderFields.subject = WalletEmailOrderJson.subject\\n  LEFT JOIN WalletPymJson ON WalletOrderFields.subject = WalletPymJson.subject\\n  LEFT JOIN WalletShipmentJson ON WalletOrderFields.subject = WalletShipmentJson.identifierOrder\\n  LEFT JOIN WalletOrderMerchant ON WalletOrderFields.subject = WalletOrderMerchant.subject\\n  LEFT JOIN WalletPersonOrderJson ON WalletOrderFields.subject = WalletPersonOrderJson.subject\\n  LEFT JOIN WalletOrderStatusFinal ON WalletOrderFields.subject = WalletOrderStatusFinal.subject\\n  LEFT JOIN WalletEmailEarliestDateFinal ON WalletOrderFields.subject = WalletEmailEarliestDateFinal.subject\\n\\n\\n\"}, \"target\": {\"database\": \"WalletPaymentsCommerce.Internal\", \"name\": \"WalletOrderExtractedView\", \"target\": \"WalletPaymentsCommerce.Internal.WalletOrderExtractedView\", \"type\": \"view\"}, \"type\": \"sqlConnection\", \"update\": {\"knowledgeGraphListeners\": [{\"filters\": [{\"entityType\": \"SB10\"}], \"fullRebuildOnChange\": true, \"rebuildView\": true, \"requiredSource\": false, \"schedule\": \"live\", \"stores\": [\"stableGraph\"]}], \"viewListeners\": [{\"diffType\": \"updatedObject\", \"filterQuery\": \"SELECT subject FROM \\\"WalletPaymentsCommerce.Internal.WalletOrderFields\\\"\", \"fullRebuildOnChange\": true, \"name\": \"WalletOrderFields\", \"rebuildView\": true, \"schedule\": \"live\"}, {\"diffType\": \"updatedObject\", \"filterQuery\": \"SELECT subject FROM \\\"WalletPaymentsCommerce.Internal.WalletTrackedOrderFields\\\"\", \"fullRebuildOnChange\": true, \"name\": \"WalletTrackedOrderFields\", \"rebuildView\": true, \"schedule\": \"live\"}, {\"diffType\": \"updatedObject\", \"filterQuery\": \"SELECT subject FROM \\\"WalletPaymentsCommerce.Internal.WalletOrder\\\"\", \"fullRebuildOnChange\": true, \"name\": \"WalletOrder\", \"rebuildView\": true, \"schedule\": \"live\"}, {\"diffType\": \"updatedObject\", \"filterQuery\": \"SELECT subject FROM \\\"WalletPaymentsCommerce.Internal.WalletOrderEmail\\\"\", \"fullRebuildOnChange\": true, \"name\": \"WalletOrderEmail\", \"rebuildView\": true, \"schedule\": \"live\"}, {\"diffType\": \"updatedObject\", \"filterQuery\": \"SELECT subject FROM \\\"WalletPaymentsCommerce.Internal.WalletOrderPayment\\\"\", \"fullRebuildOnChange\": true, \"name\": \"WalletOrderPayment\", \"rebuildView\": true, \"schedule\": \"live\"}, {\"diffType\": \"updatedObject\", \"filterQuery\": \"SELECT subject FROM \\\"WalletPaymentsCommerce.Internal.WalletOrderTransaction\\\"\", \"fullRebuildOnChange\": true, \"name\": \"WalletOrderTransaction\", \"rebuildView\": true, \"schedule\": \"live\"}, {\"diffType\": \"updatedObject\", \"filterQuery\": \"SELECT subject FROM \\\"WalletPaymentsCommerce.Internal.WalletOrderShipmentFullFillmentInfo\\\"\", \"fullRebuildOnChange\": true, \"name\": \"WalletOrderShipmentFullFillmentInfo\", \"rebuildView\": true, \"schedule\": \"live\"}, {\"diffType\": \"updatedObject\", \"filterQuery\": \"SELECT subject FROM \\\"WalletPaymentsCommerce.Internal.WalletOrderPerson\\\"\", \"fullRebuildOnChange\": true, \"name\": \"WalletOrderPerson\", \"rebuildView\": true, \"requiredSource\": true, \"schedule\": \"live\"}]}, \"uuid\": \"456D4F37-51DB-4E59-B38A-C155C57FF5CB\", \"version\": \"65effd5f-0ebc-4484-b36f-545a6006c76f\", \"writeToStream\": true}"
- "abff9c36b3aa5c23428010f8bafd538d2ef0f106df2d8be79030c1a8811aed6b"
- "d97930fa-0acb-4f07-9cc1-4e0d80cb7c64"
- "{\"configHash\": \"abff9c36b3aa5c23428010f8bafd538d2ef0f106df2d8be79030c1a8811aed6b\", \"dependencies\": [\"WalletOrderFields\", \"WalletTrackedOrderFields\", \"WalletOrder\", \"WalletOrderEmail\", \"WalletOrderPayment\", \"WalletOrderTransaction\", \"WalletOrderShipmentFullFillmentInfo\", \"WalletOrderPerson\"], \"dependents\": [\"WalletCascadeInsert\"], \"deployment\": [\"production\"], \"featureFlag\": \"OrionSQL\", \"legacyName\": \"WalletOrderExtractedView\", \"name\": \"WalletOrderExtractedView\", \"platforms\": {\"iOS\": \"18.0\"}, \"sql\": {\"update\": \"WITH WalletOrderFields AS (\\n  SELECT\\n    wof.*\\n  FROM\\n    (\\n      SELECT DISTINCT\\n        identifier\\n      FROM\\n        \\\"WalletPaymentsCommerce.Internal.WalletOrder\\\"\\n      WHERE\\n        referenceEntityIdType = 'emailIdentifier'\\n    ) AS EmailLinkedOrder\\n    INNER JOIN \\\"WalletPaymentsCommerce.Internal.WalletOrderFields\\\" wof ON EmailLinkedOrder.identifier = wof.identifier\\n),\\nWalletEmailOrder AS (\\n  SELECT\\n    subject,\\n    orderNumber,\\n    referenceId\\n  FROM\\n    \\\"WalletPaymentsCommerce.Internal.WalletOrder\\\"\\n  WHERE\\n    referenceEntityIdType = 'emailIdentifier'\\n),\\nWalletOrderMerchantListByEmail AS (\\n  SELECT\\n    ROW_NUMBER() OVER (\\n      PARTITION BY WalletEmailOrder.subject\\n      ORDER BY\\n        emailSentDate ASC\\n    ) as rn,\\n    WalletEmailOrder.subject,\\n    origOrderNumber as orderNumber,\\n    origMerchantName AS merchantName,\\n    emailSentDate\\n  FROM\\n    WalletEmailOrder\\n    LEFT JOIN \\\"WalletPaymentsCommerce.Internal.WalletOrderEmail\\\" we ON WalletEmailOrder.referenceId = we.subject\\n),\\nWalletTrackedOrderFields AS (\\n  SELECT\\n    subject,\\n    trkOrderNumber as orderNumber,\\n    trkMerchantName as merchantName,\\n    trkOrderStatus as orderStatus,\\n    earliestEmailDateSent as earliestEmailDateSent,\\n    displayNameUpdateDate ,\\n    orderStatusUpdateDate\\n  FROM\\n    \\\"WalletPaymentsCommerce.Internal.WalletTrackedOrderFields\\\"\\n),\\nWalletOrderMerchantListUnion AS (\\n    SELECT subject , orderNumber, merchantName, emailSentDate FROM WalletOrderMerchantListByEmail\\n    UNION\\n    SELECT subject, orderNumber, merchantName, displayNameUpdateDate as emailSentDate FROM\\n        WalletTrackedOrderFields WHERE displayNameUpdateDate IS NOT NULL AND displayNameUpdateDate!=''\\n),\\nWalletOrderEmailEarliestDateList AS (\\n    SELECT subject , emailSentDate AS earliestEmailDateSent FROM WalletOrderMerchantListByEmail\\n    UNION\\n    SELECT subject, earliestEmailDateSent FROM walletTrackedOrderFields WHERE earliestEmailDateSent IS NOT NULL AND earliestEmailDateSent!=''\\n),\\nWalletEmailsUnionRanked AS  (SELECT *,  ROW_NUMBER() OVER (\\n      PARTITION BY subject\\n      ORDER BY\\n        earliestEmailDateSent ASC\\n    ) as rn FROM WalletOrderEmailEarliestDateList),\\nWalletEmailEarliestDateFinal AS (\\n    SELECT subject, earliestEmailDateSent FROM WalletEmailsUnionRanked WHERE rn =1 ),\\nWalletOrderMerchantList AS (\\n    SELECT\\n      ROW_NUMBER() OVER (\\n        PARTITION BY subject\\n        ORDER BY\\n          emailSentDate ASC\\n      ) as rn,\\n      subject,\\n      orderNumber,\\n      merchantName,\\n      emailSentDate AS displayNameUpdateDate FROM\\n    WalletOrderMerchantListUnion\\n),\\nWalletOrderStatusRanked AS (\\n  SELECT\\n    WalletEmailOrder.subject,\\n    orderNumber,\\n    CASE\\n      WHEN emailType = '1' THEN '1'\\n      WHEN emailType = '3' THEN '3'\\n      WHEN emailType = '4' THEN '4'\\n      ELSE NULL\\n    END AS emailOrderStatus,\\n    emailSentDate\\n  FROM\\n    WalletEmailOrder\\n    LEFT JOIN \\\"WalletPaymentsCommerce.Internal.WalletOrderEmail\\\" we ON WalletEmailOrder.referenceId = we.subject\\n    UNION\\n  SELECT subject, orderNumber, orderStatus AS emailOrderStatus, orderStatusUpdateDate AS emailSentDate FROM WalletTrackedOrderFields\\n),\\nWalletOrderStatusRankedList AS (\\n  SELECT\\n    *,\\n    ROW_NUMBER() OVER (\\n      PARTITION BY WalletOrderStatusRanked.subject\\n      ORDER BY\\n        emailSentDate DESC\\n    ) as rn\\n  FROM\\n    WalletOrderStatusRanked\\n  where\\n    emailOrderStatus IS NOT NULL\\n),\\nWalletOrderStatusFinal AS (\\n  SELECT\\n    subject,\\n    orderNumber,\\n    emailOrderStatus AS orderStatus,\\n    emailSentDate AS orderStatusUpdateDate\\n  FROM\\n    WalletOrderStatusRankedList\\n  WHERE\\n    rn = 1\\n),\\nWalletOrderMerchant AS (\\n  SELECT\\n    subject,\\n    merchantName,\\n    orderNumber,\\n    JSON_OBJECT('displayName', merchantName,\\n     'displayNameUpdateDate',  CAST(displayNameUpdateDate AS REAL)) AS merchantJson\\n  FROM\\n    WalletOrderMerchantList\\n  WHERE\\n    rn = 1\\n),\\nWalletPersonOrder AS (\\n  SELECT\\n    subject,\\n    orderNumber,\\n    referenceId\\n  FROM\\n    walletOrder\\n  WHERE\\n    referenceEntityIdType = 'customerIdentifier'\\n),\\nWalletPersonOrderJson AS (\\n  SELECT\\n    WalletPersonOrder.subject,\\n    JSON_OBJECT(\\n      'fullName',\\n      name,\\n      'phoneNumber',\\n      phone,\\n      'emailAddress',\\n      email,\\n      'billingAddress',\\n      JSON_OBJECT(\\n        'street',\\n        street,\\n        'city',\\n        city,\\n        'state',\\n        state,\\n        'country',\\n        country,\\n        'postalCode',\\n        postal,\\n        'rawAddress',\\n        rawAddress\\n      )\\n    ) AS personJson\\n  FROM\\n    WalletPersonOrder\\n    LEFT JOIN \\\"WalletPaymentsCommerce.Internal.WalletOrderPerson\\\" wop ON WalletPersonOrder.referenceId = wop.subject\\n),\\nWalletPymOrder AS (\\n  SELECT\\n    subject,\\n    orderNumber,\\n    referenceId\\n  FROM\\n    \\\"WalletPaymentsCommerce.Internal.WalletOrder\\\"\\n  WHERE\\n    referenceEntityIdType = 'paymentIdentifier'\\n),\\nWalletTrxOrder AS (\\n  SELECT\\n    subject,\\n    orderNumber,\\n    referenceId\\n  FROM\\n    \\\"WalletPaymentsCommerce.Internal.WalletOrder\\\"\\n  WHERE\\n    referenceEntityIdType = 'transactionIdentifier'\\n),\\nWalletPymTbl AS (\\n  SELECT\\n    WalletPymOrder.subject,\\n    orderNumber,\\n    totalAmount,\\n    currencyCode,\\n    ROW_NUMBER() OVER (\\n      PARTITION BY WalletPymOrder.subject\\n      ORDER BY\\n        totalAmount DESC\\n    ) AS rn\\n  FROM\\n    WalletPymOrder\\n    LEFT JOIN \\\"WalletPaymentsCommerce.Internal.WalletOrderPayment\\\" wop ON WalletPymOrder.referenceId = wop.subject\\n),\\nWalletPymCol AS (\\n  SELECT\\n    subject,\\n    orderNumber,\\n    totalAmount,\\n    currencyCode\\n  FROM\\n    WalletPymTbl\\n  where\\n    rn = 1\\n),\\nWalletTrxCol AS (\\n  SELECT DISTINCT\\n    WalletTrxOrder.subject,\\n    JSON_GROUP_ARRAY(\\n      JSON_OBJECT(\\n        'amount',\\n        totalAmount,\\n        'isoCurrencyCode',\\n        currencyCode,\\n        'transactionIdenifier',\\n        trxId,\\n        'paymentMethod',\\n        JSON_OBJECT(\\n          'lastFourDigits',\\n          accountLastFourDigits,\\n          'displayName',\\n          accountInstitution\\n        )\\n      )\\n    ) AS trxInfo\\n  FROM\\n    WalletTrxOrder\\n    LEFT JOIN \\\"WalletPaymentsCommerce.Internal.WalletOrderTransaction\\\" wot ON WalletTrxOrder.referenceId = wot.subject\\n  WHERE\\n    currencyCode IS NOT NULL\\n    OR totalAmount IS NOT NULL\\n    OR accountInstitution IS NOT NULL\\n    OR accountLastFourDigits IS NOT NULL\\n  GROUP BY\\n    WalletTrxOrder.subject\\n),\\nWalletPymJson AS (\\n  SELECT\\n    WalletPymCol.subject,\\n    JSON_OBJECT(\\n      'totalAmount',\\n      totalAmount,\\n      'totalIsoCurrencyCode',\\n      currencyCode,\\n      'transactions',\\n      json_extract(trxInfo, '$')\\n    ) AS orderPayment\\n  FROM\\n    WalletPymCol\\n    LEFT JOIN WalletTrxCol ON WalletPymCol.subject = WalletTrxCol.subject\\n),\\nWalletShipmentOrder AS (\\n  SELECT\\n    subject,\\n    orderNumber,\\n    referenceId\\n  FROM\\n    \\\"WalletPaymentsCommerce.Internal.WalletOrder\\\"\\n  WHERE\\n    referenceEntityIdType = 'shipmentFullFillmentIdentifier'\\n),\\nWalletDedupeShipment AS (\\n  SELECT DISTINCT\\n    WalletShipmentOrder.subject AS identifierOrder,\\n    WalletShipmentOrder.orderNumber,\\n    wosfi.*\\n  FROM\\n    WalletShipmentOrder\\n    LEFT JOIN \\\"WalletPaymentsCommerce.Internal.WalletOrderShipmentFullFillmentInfo\\\" wosfi ON WalletShipmentOrder.referenceId = wosfi.subject\\n),\\nWalletShipmentOrderByEmail AS (\\n  SELECT\\n    WalletDedupeShipment.subject AS orderIdentifier,\\n    *,\\n    ROW_NUMBER() OVER (\\n      PARTITION BY orderNumber,\\n      trackingNumber\\n      ORDER BY\\n        fullfillmentUpdateDate DESC,\\n        emailSentDate DESC\\n    ) AS rn\\n  FROM\\n    WalletDedupeShipment\\n    LEFT JOIN \\\"WalletPaymentsCommerce.Internal.WalletOrderEmail\\\" we ON WalletDedupeShipment.emailIdentifier = we.subject\\n),\\nWalletShipmentWithFilledValues AS (\\n  SELECT\\n    s1.*,\\n    COALESCE(s1.carrierName,\\n      (SELECT s2.carrierName FROM WalletShipmentOrderByEmail s2\\n       WHERE s2.orderNumber = s1.orderNumber AND s2.trackingNumber = s1.trackingNumber AND s2.carrierName IS NOT NULL\\n       ORDER BY s2.fullfillmentUpdateDate DESC, s2.emailSentDate DESC LIMIT 1)) AS filled_carrierName,\\n    COALESCE(s1.trackingNumber,\\n      (SELECT s2.trackingNumber FROM WalletShipmentOrderByEmail s2\\n       WHERE s2.orderNumber = s1.orderNumber AND s2.trackingNumber = s1.trackingNumber AND s2.trackingNumber IS NOT NULL\\n       ORDER BY s2.fullfillmentUpdateDate DESC, s2.emailSentDate DESC LIMIT 1)) AS filled_trackingNumber,\\n    COALESCE(s1.shippingMethod,\\n      (SELECT s2.shippingMethod FROM WalletShipmentOrderByEmail s2\\n       WHERE s2.orderNumber = s1.orderNumber AND s2.trackingNumber = s1.trackingNumber AND s2.shippingMethod IS NOT NULL\\n       ORDER BY s2.fullfillmentUpdateDate DESC, s2.emailSentDate DESC LIMIT 1)) AS filled_shippingMethod,\\n    COALESCE(s1.shippingStatus,\\n      (SELECT s2.shippingStatus FROM WalletShipmentOrderByEmail s2\\n       WHERE s2.orderNumber = s1.orderNumber AND s2.trackingNumber = s1.trackingNumber AND s2.shippingStatus IS NOT NULL\\n       ORDER BY s2.fullfillmentUpdateDate DESC, s2.emailSentDate DESC LIMIT 1)) AS filled_shippingStatus,\\n    COALESCE(s1.shippingDate,\\n      (SELECT s2.shippingDate FROM WalletShipmentOrderByEmail s2\\n       WHERE s2.orderNumber = s1.orderNumber AND s2.trackingNumber = s1.trackingNumber AND s2.shippingDate IS NOT NULL\\n       ORDER BY s2.fullfillmentUpdateDate DESC, s2.emailSentDate DESC LIMIT 1)) AS filled_shippingDate,\\n    COALESCE(s1.estimatedDeliveryStartDate,\\n      (SELECT s2.estimatedDeliveryStartDate FROM WalletShipmentOrderByEmail s2\\n       WHERE s2.orderNumber = s1.orderNumber AND s2.trackingNumber = s1.trackingNumber AND s2.estimatedDeliveryStartDate IS NOT NULL\\n       ORDER BY s2.fullfillmentUpdateDate DESC, s2.emailSentDate DESC LIMIT 1)) AS filled_estimatedDeliveryStartDate,\\n    COALESCE(s1.estimatedDeliveryStartTime,\\n      (SELECT s2.estimatedDeliveryStartTime FROM WalletShipmentOrderByEmail s2\\n       WHERE s2.orderNumber = s1.orderNumber AND s2.trackingNumber = s1.trackingNumber AND s2.estimatedDeliveryStartTime IS NOT NULL\\n       ORDER BY s2.fullfillmentUpdateDate DESC, s2.emailSentDate DESC LIMIT 1)) AS filled_estimatedDeliveryStartTime,\\n    COALESCE(s1.estimatedDeliveryEndDate,\\n      (SELECT s2.estimatedDeliveryEndDate FROM WalletShipmentOrderByEmail s2\\n       WHERE s2.orderNumber = s1.orderNumber AND s2.trackingNumber = s1.trackingNumber AND s2.estimatedDeliveryEndDate IS NOT NULL\\n       ORDER BY s2.fullfillmentUpdateDate DESC, s2.emailSentDate DESC LIMIT 1)) AS filled_estimatedDeliveryEndDate,\\n    COALESCE(s1.estimatedDeliveryEndTime,\\n      (SELECT s2.estimatedDeliveryEndTime FROM WalletShipmentOrderByEmail s2\\n       WHERE s2.orderNumber = s1.orderNumber AND s2.trackingNumber = s1.trackingNumber AND s2.estimatedDeliveryEndTime IS NOT NULL\\n       ORDER BY s2.fullfillmentUpdateDate DESC, s2.emailSentDate DESC LIMIT 1)) AS filled_estimatedDeliveryEndTime,\\n    COALESCE(s1.deliveryDate,\\n      (SELECT s2.deliveryDate FROM WalletShipmentOrderByEmail s2\\n       WHERE s2.orderNumber = s1.orderNumber AND s2.trackingNumber = s1.trackingNumber AND s2.deliveryDate IS NOT NULL\\n       ORDER BY s2.fullfillmentUpdateDate DESC, s2.emailSentDate DESC LIMIT 1)) AS filled_deliveryDate,\\n    COALESCE(s1.deliveryTime,\\n      (SELECT s2.deliveryTime FROM WalletShipmentOrderByEmail s2\\n       WHERE s2.orderNumber = s1.orderNumber AND s2.trackingNumber = s1.trackingNumber AND s2.deliveryTime IS NOT NULL\\n       ORDER BY s2.fullfillmentUpdateDate DESC, s2.emailSentDate DESC LIMIT 1)) AS filled_deliveryTime,\\n    COALESCE(s1.personIdentifier,\\n         (SELECT s2.personIdentifier FROM WalletShipmentOrderByEmail s2\\n          WHERE s2.orderNumber = s1.orderNumber AND s2.trackingNumber = s1.trackingNumber AND s2.personIdentifier IS NOT NULL\\n          ORDER BY s2.fullfillmentUpdateDate DESC, s2.emailSentDate DESC LIMIT 1)) AS filled_personIdentifier\\n  FROM WalletShipmentOrderByEmail s1 WHERE rn=1\\n),\\nWalletShippingRecepientOrderJson AS (\\n    SELECT\\n      WalletShipmentWithFilledValues.subject,\\n      *,\\n      JSON_OBJECT(\\n        'fullName',\\n        name,\\n        'phoneNumber',\\n        phone,\\n        'emailAddress',\\n        email,\\n        'address',\\n        JSON_OBJECT(\\n          'street',\\n          street,\\n          'city',\\n          city,\\n          'state',\\n          state,\\n          'country',\\n          country,\\n          'postalCode',\\n          postal,\\n          'rawAddress',\\n          rawAddress\\n        )\\n      ) AS shippingRecepientJson\\n    FROM\\n      WalletShipmentWithFilledValues\\n      LEFT JOIN \\\"WalletOrderPerson\\\" wop ON wop.subject = WalletShipmentWithFilledValues.filled_personIdentifier\\n      WHERE rn=1\\n),\\nWalletShipmentJson AS (\\n    SELECT\\n      WalletShipmentWithFilledValues.identifierOrder AS identifierOrder,\\n      WalletShipmentWithFilledValues.orderNumber,\\n      JSON_GROUP_ARRAY(\\n        JSON_OBJECT(\\n          'carrierName',\\n          WalletShipmentWithFilledValues.filled_carrierName,\\n          'trackingNumber',\\n          WalletShipmentWithFilledValues.filled_trackingNumber,\\n          'shippingMethod',\\n          WalletShipmentWithFilledValues.filled_shippingMethod,\\n          'status',\\n          CAST(\\n            WalletShipmentWithFilledValues.filled_shippingStatus AS INTEGER\\n          ),\\n          'shippingDate',\\n          WalletShipmentWithFilledValues.filled_shippingDate,\\n          'estimatedDeliveryStartDate',\\n          WalletShipmentWithFilledValues.filled_estimatedDeliveryStartDate,\\n          'estimatedDeliveryStartTime',\\n          WalletShipmentWithFilledValues.filled_estimatedDeliveryStartTime,\\n          'estimatedDeliveryEndDate',\\n          WalletShipmentWithFilledValues.filled_estimatedDeliveryEndDate,\\n          'estimatedDeliveryEndTime',\\n          WalletShipmentWithFilledValues.filled_estimatedDeliveryEndTime,\\n          'deliveryDate',\\n          WalletShipmentWithFilledValues.filled_deliveryDate,\\n          'deliveryTime',\\n          WalletShipmentWithFilledValues.filled_deliveryTime,\\n          'fulfillmentUpdateDate',\\n          (\\n            CASE\\n              WHEN WalletShipmentWithFilledValues.emailSentDate IS NULL THEN CAST(\\n                WalletShipmentWithFilledValues.fullfillmentUpdateDate AS REAL\\n              )\\n              WHEN WalletShipmentWithFilledValues.fullfillmentUpdateDate IS NULL THEN CAST(\\n                WalletShipmentWithFilledValues.emailSentDate AS REAL\\n              )\\n              WHEN CAST(\\n                WalletShipmentWithFilledValues.emailSentDate AS REAL\\n              ) > CAST(\\n                WalletShipmentWithFilledValues.fullfillmentUpdateDate AS REAL\\n              ) THEN CAST(\\n                WalletShipmentWithFilledValues.emailSentDate AS REAL\\n              )\\n              ELSE CAST(\\n                WalletShipmentWithFilledValues.fullfillmentUpdateDate AS REAL\\n              )\\n            END\\n          ),\\n          'shippingRecipient',\\n          json_extract(\\n            WalletShippingRecepientOrderJson.shippingRecepientJson,\\n            '$'\\n          )\\n        )\\n      ) AS shipmentJson\\n    FROM\\n      WalletShipmentWithFilledValues\\n      LEFT JOIN WalletShippingRecepientOrderJson ON WalletShippingRecepientOrderJson.orderIdentifier = WalletShipmentWithFilledValues.orderIdentifier\\n    WHERE\\n      WalletShipmentWithFilledValues.rn = 1\\n      GROUP BY\\n    WalletShipmentWithFilledValues.identifierOrder\\n),\\nWalletEmailShipping AS (\\n  SELECT\\n    shippingStatus,\\n    trackingNumber,\\n    carrierName,\\n    we.subject\\n  FROM\\n    \\\"WalletPaymentsCommerce.Internal.WalletOrderShipmentFullFillmentInfo\\\" wosfi\\n    LEFT JOIN \\\"WalletPaymentsCommerce.Internal.WalletOrderEmail\\\" we ON wosfi.emailIdentifier = we.subject\\n),\\nWalletEmailOrderJson AS (\\n  SELECT\\n    WalletEmailOrder.subject,\\n    orderNumber,\\n    JSON_GROUP_ARRAY(\\n      JSON_OBJECT(\\n        'emailType',\\n        CAST(emailType AS INTEGER),\\n        'emailMetadata',\\n        JSON_OBJECT(\\n          'messageID',\\n          messageID,\\n          'senderDomain',\\n          senderDomain,\\n          'replyToEmailAddress',\\n          emailReplyTo,\\n          'subject',\\n          emailSubject,\\n          'toEmailAddress',\\n          emailTo,\\n          'fromEmailAddress',\\n          emailFrom,\\n          'toDisplayName',\\n          emailToDisplay,\\n          'fromDisplayName',\\n          emailFromDisplay,\\n          'replyToDisplayName',\\n          emailReplyToDisplay,\\n          'dateSent',\\n          CAST(emailSentDate AS REAL)\\n        ),\\n        'orderDetails',\\n        JSON_OBJECT(\\n          'orderNumber',\\n          origOrderNumber,\\n          'merchant',\\n            JSON_OBJECT('displayName', origMerchantName),\\n          'shippingDetails',\\n          JSON_OBJECT(\\n            'status',\\n            CAST(shippingStatus AS INTEGER),\\n            'trackingNumber',\\n            origTrackingNumber,\\n            'carrierName',\\n            carrierName\\n          )\\n        ),\\n        'spotlightUniqueIdentifier',\\n        spotlightUniqueIdentifier,\\n        'spotlightDomainIdentifier',\\n        spotlightDomainIdentifier\\n      )\\n    ) AS emailArr\\n  FROM\\n    WalletEmailOrder\\n    LEFT JOIN \\\"WalletPaymentsCommerce.Internal.WalletOrderEmail\\\" we ON WalletEmailOrder.referenceId = we.subject\\n    LEFT JOIN \\\"WalletEmailShipping\\\" wes ON walletEmailOrder.referenceId = wes.subject\\n  GROUP BY\\n    WalletEmailOrder.subject\\n  ORDER BY emailSentDate DESC\\n)\\nSELECT DISTINCT\\n  WalletOrderFields.subject,\\n  'md:' || WalletOrderFields.subject AS identifier,\\n  WalletOrderFields.orderNumber AS orderNumber,\\n  JSON_OBJECT(\\n    'orderNumber',\\n    WalletOrderMerchant.orderNumber,\\n    'orderDate',\\n    WalletOrderFields.orderDate,\\n    'orderIdentifier',\\n    WalletOrderFields.orderIdentifier,\\n    'orderTypeIdentifier',\\n    WalletOrderFields.orderTypeIdentifier,\\n    'trackedOrderIdentifier',\\n    WalletOrderFields.trackedOrderIdentifier,\\n    'orderUpdateDate',\\n    CAST(WalletOrderFields.orderUpdateDate AS REAL),\\n    'orderEmails',\\n    json_extract(emailArr, '$'),\\n    'payment',\\n    json_extract(WalletPymJson.orderPayment, '$'),\\n    'shippingFulfillments',\\n    json_extract(WalletShipmentJson.shipmentJson, '$'),\\n    'merchant',\\n    json_extract(WalletOrderMerchant.merchantJson, '$'),\\n    'customer',\\n    json_extract(WalletPersonOrderJson.personJson, '$'),\\n    'orderStatus',\\n    CAST(WalletOrderStatusFinal.orderStatus AS INTEGER),\\n    'orderStatusUpdateDate',\\n    CAST(WalletOrderStatusFinal.orderStatusUpdateDate AS REAL),\\n    'earliestEmailDateSent',\\n    CAST(WalletEmailEarliestDateFinal.earliestEmailDateSent AS REAL)\\n  ) AS orderJson\\nFROM\\n  WalletOrderFields\\n  LEFT JOIN WalletEmailOrderJson ON WalletOrderFields.subject = WalletEmailOrderJson.subject\\n  LEFT JOIN WalletPymJson ON WalletOrderFields.subject = WalletPymJson.subject\\n  LEFT JOIN WalletShipmentJson ON WalletOrderFields.subject = WalletShipmentJson.identifierOrder\\n  LEFT JOIN WalletOrderMerchant ON WalletOrderFields.subject = WalletOrderMerchant.subject\\n  LEFT JOIN WalletPersonOrderJson ON WalletOrderFields.subject = WalletPersonOrderJson.subject\\n  LEFT JOIN WalletOrderStatusFinal ON WalletOrderFields.subject = WalletOrderStatusFinal.subject\\n  LEFT JOIN WalletEmailEarliestDateFinal ON WalletOrderFields.subject = WalletEmailEarliestDateFinal.subject\\n\\n\\n\"}, \"target\": {\"database\": \"WalletPaymentsCommerce.Internal\", \"name\": \"WalletOrderExtractedView\", \"target\": \"WalletPaymentsCommerce.Internal.WalletOrderExtractedView\", \"type\": \"view\"}, \"type\": \"sqlConnection\", \"update\": {\"knowledgeGraphListeners\": [{\"filters\": [{\"entityType\": \"SB10\"}], \"fullRebuildOnChange\": true, \"rebuildView\": true, \"requiredSource\": false, \"schedule\": \"live\", \"stores\": [\"stableGraph\"]}], \"viewListeners\": [{\"diffType\": \"updatedObject\", \"filterQuery\": \"SELECT subject FROM \\\"WalletPaymentsCommerce.Internal.WalletOrderFields\\\"\", \"fullRebuildOnChange\": true, \"name\": \"WalletOrderFields\", \"rebuildView\": true, \"schedule\": \"live\"}, {\"diffType\": \"updatedObject\", \"filterQuery\": \"SELECT subject FROM \\\"WalletPaymentsCommerce.Internal.WalletTrackedOrderFields\\\"\", \"fullRebuildOnChange\": true, \"name\": \"WalletTrackedOrderFields\", \"rebuildView\": true, \"schedule\": \"live\"}, {\"diffType\": \"updatedObject\", \"filterQuery\": \"SELECT subject FROM \\\"WalletPaymentsCommerce.Internal.WalletOrder\\\"\", \"fullRebuildOnChange\": true, \"name\": \"WalletOrder\", \"rebuildView\": true, \"schedule\": \"live\"}, {\"diffType\": \"updatedObject\", \"filterQuery\": \"SELECT subject FROM \\\"WalletPaymentsCommerce.Internal.WalletOrderEmail\\\"\", \"fullRebuildOnChange\": true, \"name\": \"WalletOrderEmail\", \"rebuildView\": true, \"schedule\": \"live\"}, {\"diffType\": \"updatedObject\", \"filterQuery\": \"SELECT subject FROM \\\"WalletPaymentsCommerce.Internal.WalletOrderPayment\\\"\", \"fullRebuildOnChange\": true, \"name\": \"WalletOrderPayment\", \"rebuildView\": true, \"schedule\": \"live\"}, {\"diffType\": \"updatedObject\", \"filterQuery\": \"SELECT subject FROM \\\"WalletPaymentsCommerce.Internal.WalletOrderTransaction\\\"\", \"fullRebuildOnChange\": true, \"name\": \"WalletOrderTransaction\", \"rebuildView\": true, \"schedule\": \"live\"}, {\"diffType\": \"updatedObject\", \"filterQuery\": \"SELECT subject FROM \\\"WalletPaymentsCommerce.Internal.WalletOrderShipmentFullFillmentInfo\\\"\", \"fullRebuildOnChange\": true, \"name\": \"WalletOrderShipmentFullFillmentInfo\", \"rebuildView\": true, \"schedule\": \"live\"}, {\"diffType\": \"updatedObject\", \"filterQuery\": \"SELECT subject FROM \\\"WalletPaymentsCommerce.Internal.WalletOrderPerson\\\"\", \"fullRebuildOnChange\": true, \"name\": \"WalletOrderPerson\", \"rebuildView\": true, \"requiredSource\": true, \"schedule\": \"live\"}]}, \"uuid\": \"456D4F37-51DB-4E59-B38A-C155C57FF5CB\", \"version\": \"d97930fa-0acb-4f07-9cc1-4e0d80cb7c64\", \"writeToStream\": true}"

```
