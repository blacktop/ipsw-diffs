## amsengagementd

> `/System/Library/PrivateFrameworks/AppleMediaServicesUI.framework/amsengagementd`

```diff

-5.3.4.0.0
-  __TEXT.__text: 0x18ebb0
-  __TEXT.__auth_stubs: 0x2f90
+5.4.30.2.6
+  __TEXT.__text: 0x1c0da8
+  __TEXT.__auth_stubs: 0x31a0
   __TEXT.__objc_stubs: 0x1e00
-  __TEXT.__objc_methlist: 0x1344
-  __TEXT.__const: 0x7a60
+  __TEXT.__objc_methlist: 0x152c
+  __TEXT.__const: 0x8c30
   __TEXT.__gcc_except_tab: 0x74
-  __TEXT.__cstring: 0xe0ba
+  __TEXT.__cstring: 0xf85a
   __TEXT.__oslogstring: 0xf13
-  __TEXT.__objc_classname: 0x453
-  __TEXT.__objc_methname: 0x54a9
-  __TEXT.__objc_methtype: 0x16a0
+  __TEXT.__objc_classname: 0x46b
+  __TEXT.__objc_methname: 0x56f7
+  __TEXT.__objc_methtype: 0x16dc
   __TEXT.__dlopen_cstrs: 0x104
-  __TEXT.__constg_swiftt: 0x4594
-  __TEXT.__swift5_typeref: 0x4ff3
-  __TEXT.__swift5_builtin: 0x1a4
-  __TEXT.__swift5_reflstr: 0x20e6
-  __TEXT.__swift5_fieldmd: 0x33f4
-  __TEXT.__swift5_assocty: 0x4b8
-  __TEXT.__swift5_proto: 0x6c8
-  __TEXT.__swift5_types: 0x40c
-  __TEXT.__swift5_capture: 0x2fd4
+  __TEXT.__constg_swiftt: 0x4cec
+  __TEXT.__swift5_typeref: 0x56a7
+  __TEXT.__swift5_builtin: 0x258
+  __TEXT.__swift5_reflstr: 0x24d6
+  __TEXT.__swift5_fieldmd: 0x3944
+  __TEXT.__swift5_assocty: 0x590
+  __TEXT.__swift5_proto: 0x7c8
+  __TEXT.__swift5_types: 0x494
+  __TEXT.__swift5_capture: 0x3710
   __TEXT.__swift5_protos: 0x80
   __TEXT.__swift5_mpenum: 0x28
-  __TEXT.__unwind_info: 0x6ac0
-  __TEXT.__eh_frame: 0x8da4
-  __DATA_CONST.__auth_got: 0x17d8
-  __DATA_CONST.__got: 0x690
-  __DATA_CONST.__auth_ptr: 0x3a8
-  __DATA_CONST.__const: 0xd7d0
+  __TEXT.__unwind_info: 0x7458
+  __TEXT.__eh_frame: 0xab0c
+  __DATA_CONST.__auth_got: 0x18e0
+  __DATA_CONST.__got: 0x6e0
+  __DATA_CONST.__auth_ptr: 0x3e0
+  __DATA_CONST.__const: 0xf548
   __DATA_CONST.__cfstring: 0x820
-  __DATA_CONST.__objc_classlist: 0x350
-  __DATA_CONST.__objc_catlist: 0x90
-  __DATA_CONST.__objc_protolist: 0x320
+  __DATA_CONST.__objc_classlist: 0x390
+  __DATA_CONST.__objc_catlist: 0xa0
+  __DATA_CONST.__objc_protolist: 0x350
   __DATA_CONST.__objc_imageinfo: 0x8
-  __DATA.__objc_const: 0x9b60
-  __DATA.__objc_selrefs: 0x19d0
-  __DATA.__objc_protorefs: 0x1c0
-  __DATA.__objc_classrefs: 0x548
-  __DATA.__objc_superrefs: 0x30
+  __DATA_CONST.__objc_protorefs: 0x1e0
+  __DATA_CONST.__objc_classrefs: 0x560
+  __DATA_CONST.__objc_superrefs: 0x30
+  __DATA.__objc_const: 0xa5b8
+  __DATA.__objc_selrefs: 0x1aa0
   __DATA.__objc_ivar: 0x48
-  __DATA.__objc_data: 0x3488
-  __DATA.__data: 0x8d88
-  __DATA.__bss: 0xc2b0
-  __DATA.__common: 0x170
+  __DATA.__objc_data: 0x3ae0
+  __DATA.__data: 0x9b58
+  __DATA.__bss: 0xe2b0
+  __DATA.__common: 0x168
   - /System/Library/Frameworks/Accounts.framework/Accounts
   - /System/Library/Frameworks/CloudKit.framework/CloudKit
   - /System/Library/Frameworks/Combine.framework/Combine

   - /System/Library/PrivateFrameworks/SharedWebCredentials.framework/SharedWebCredentials
   - /System/Library/PrivateFrameworks/SoftLinking.framework/SoftLinking
   - /System/Library/PrivateFrameworks/UIKitCore.framework/UIKitCore
+  - /System/Library/PrivateFrameworks/iTunesCloud.framework/iTunesCloud
   - /usr/lib/libSystem.B.dylib
   - /usr/lib/libobjc.A.dylib
   - /usr/lib/libsqlite3.dylib
   - /usr/lib/swift/libswiftAVFoundation.dylib
+  - /usr/lib/swift/libswiftAccelerate.dylib
   - /usr/lib/swift/libswiftCompression.dylib
   - /usr/lib/swift/libswiftCore.dylib
   - /usr/lib/swift/libswiftCoreAudio.dylib

   - /usr/lib/swift/libswift_Concurrency.dylib
   - /usr/lib/swift/libswiftos.dylib
   - /usr/lib/swift/libswiftsimd.dylib
-  Functions: 10498
-  Symbols:   1343
-  CStrings:  2756
+  Functions: 11944
+  Symbols:   1393
+  CStrings:  2933
 
Symbols:
+ _$s10Foundation10CocoaErrorV03_nsC0So7NSErrorCvg
+ _$s10Foundation10CocoaErrorV4CodeV18fileReadNoSuchFileAEvgZ
+ _$s10Foundation10CocoaErrorV4CodeVMa
+ _$s10Foundation10CocoaErrorVAA21_BridgedStoredNSErrorAAMc
+ _$s10Foundation10CocoaErrorVMa
+ _$s10Foundation12CharacterSetV14urlHostAllowedACvgZ
+ _$s10Foundation12CharacterSetVMa
+ _$s10Foundation21_BridgedStoredNSErrorPAAE_8userInfox4CodeQz_SDySSypGtcfC
+ _$s10Foundation3URLV13DirectoryHintO02isC0yA2EmFWC
+ _$s10Foundation3URLV4path14percentEncodedSSSb_tF
+ _$s10Foundation4DataV06InlineB0VyAESWcfC
+ _$s10Foundation4DataV10LargeSliceVyAESWcfC
+ _$s10Foundation4DataV11InlineSliceVyAESWcfC
+ _$s10Foundation4DataV5bytes5countACSV_SitcfC
+ _$s9JetEngine04DiskA18PackResourceBundleV18cleanUpOldSessions7baseURLy10Foundation0L0V_tFZ
+ _$s9JetEngine19RunLoopWorkerThreadCAA13TaskSchedulerAAWP
+ _$s9JetEngine33ConditionallyExpressibleByJSValueMp
+ _$s9JetEngine33ConditionallyExpressibleByJSValuePyxSo0F0CKcfCTq
+ _$s9JetEngine3BagV03amsC0So14AMSBagProtocol_pvg
+ _$s9JetEngine7JSErrorV8badValue8expectedACSo7JSValueC_SStcfC
+ _$s9JetEngine7JSErrorVs5ErrorAAMc
+ _$s9JetEngine7JSStackC8asPartOf14virtualMachine13configuration19customPrerequisites07qualityF7ServiceAcA15BaseObjectGraphC_So09JSVirtualH0CAC27StandardGlobalConfigurationVSayAC12PrerequisiteOGSo09NSQualityfM0VtKcfC
+ _$s9JetEngine7PromiseC10invalidateyys5Error_pF
+ _$sSYsSERzSi8RawValueSYRtzrlE6encode2toys7Encoder_p_tKF
+ _$sSYsSeRzSi8RawValueSYRtzrlE4fromxs7Decoder_p_tKcfC
+ _$sSo17NSKeyedUnarchiverC10FoundationE16unarchivedObject9ofClasses4fromypSgSayyXlXpG_AC4DataVtKFZ
+ _$sSo7JSValueC9JetEngineE6stringSSSgvg
+ _$sSo7JSValueC9JetEngineEyABSScig
+ _$sSo8NSNumberC10FoundationE14booleanLiteralABSb_tcfC
+ _$sSw10copyMemory4fromySW_tF
+ _$sSy10FoundationE21addingPercentEncoding21withAllowedCharactersSSSgAA12CharacterSetV_tF
+ _$sSy10FoundationE23removingPercentEncodingSSSgvg
+ _$ss17_assertionFailure__4file4line5flagss5NeverOs12StaticStringV_A2HSus6UInt32VtF
+ _$ss18_fatalErrorMessage__4file4line5flagss5NeverOs12StaticStringV_A2HSus6UInt32VtF
+ _$ss19DiscardingTaskGroupV22awaitAllRemainingTasksyyYaKF
+ _$ss19DiscardingTaskGroupV22awaitAllRemainingTasksyyYaKFTu
+ _$ss5NeverON
+ _$ss5NeverOs5ErrorsWP
+ _ACAccountTypeIdentifieriTunesStore
+ _AMSErrorDomain
+ _AMSHTTPHeaderUserAgent
+ _ICMusicSubscriptionStatusDidChangeNotification
+ _OBJC_CLASS_$_AMSDeviceAccountPrivacyAcknowledgementTask
+ _OBJC_CLASS_$_AMSMarketingItem
+ _OBJC_CLASS_$_AMSMarketingItemTask
+ _OBJC_CLASS_$_SwiftNativeNSObject
+ _OBJC_METACLASS_$_SwiftNativeNSObject
+ __swift_FORCE_LOAD_$_swiftAccelerate
+ _malloc
+ _swift_allocateGenericClassMetadata
+ _swift_asyncLet_begin
+ _swift_asyncLet_finish
+ _swift_asyncLet_get
+ _swift_initClassMetadata2
+ _swift_taskGroup_destroy
+ _swift_taskGroup_initializeWithFlags
- _$s9JetEngine7JSStackC8asPartOf14virtualMachine13configuration19customPrerequisitesAcA15BaseObjectGraphC_So09JSVirtualH0CAC27StandardGlobalConfigurationVSayAC12PrerequisiteOGtKcfC
- _$s9JetEngine7PromiseC10isResolvedSbvg
- _$sSw5countSivg
- _$ss5UInt8VN
- _ASDSubscriptionEntitlementsMusicDidChangeNotification
- _swift_unknownObjectWeakAssign
CStrings:
+ " = {\n    identifier: "
+ " AND ((storefront IS null) OR (storefront = ?))"
+ "$__lazy_storage_$_database"
+ "$__lazy_storage_$_treatmentStoreServicePromise"
+ "(metadata LIKE ? OR metadata LIKE ? OR metadata LIKE ? OR metadata LIKE ?)"
+ ") VALUES (?,?,?,?,?,?, ?)"
+ ") VALUES (?,?,?,?,?,?,?,?);"
+ "@\"_TtC14amsengagementd11JSMarketing\"16@0:8"
+ "@\"_TtC14amsengagementd5JSApp\"16@0:8"
+ "@24@0:8@\"NSCoder\"16"
+ "@32@0:8@\"NSString\"16@\"NSDictionary\"24"
+ "AMSMarketingItemCacher"
+ "Account decoding failed"
+ "All downloads for batchKey"
+ "All tasks for batchKey finished"
+ "Bag key marketing-item-cache-enabled is false."
+ "Batch downloading failed for batchKey"
+ "Batch is not complete, returning early"
+ "BatchDownloadFailed"
+ "CREATE TABLE areasByNamespace (areaID TEXT, namespace TEXT)"
+ "CREATE TABLE areasByTopic (areaID TEXT, topic TEXT)"
+ "Can't construct Array with count < 0"
+ "Cannot handle privacy UI while buddy is running"
+ "Checking if synchronization was forced"
+ "Context file name could not be encoded"
+ "Could not find account for event"
+ "Creating JS stack (qualityOfService: "
+ "Creating directory: "
+ "DisplayRestrictionsChanged"
+ "Division by zero"
+ "Division results in an overflow"
+ "DynamicTreatmentsStorageAccessQueue"
+ "Enqueueing event for "
+ "Evaluating native privacy event"
+ "Extension Request Failed"
+ "Extension timeout"
+ "Failed to batch download:"
+ "Failed to cache display criteria at "
+ "Failed to create directory: "
+ "Failed to enqueue event for "
+ "Failed to enumerate content for batchKey"
+ "Failed to enumerate content for metadata"
+ "Failed to fetch \"treatment-store-force-synchronization\" bag value: "
+ "Failed to fetch marketing items. Error:"
+ "Failed to parse file: "
+ "Failed to save content."
+ "Failed to save filePath."
+ "Failed to serialize jsData"
+ "Failed to unarchive display criteria at "
+ "Fetching marketing item with a MediaAPI task. Request:"
+ "Force synchronization: "
+ "Found existing info"
+ "INSERT INTO areasByNamespace (areaID, namespace) VALUES (?,?)"
+ "INSERT INTO areasByTopic (areaID, topic) VALUES (?,?)"
+ "Insufficient space allocated to copy string contents"
+ "Last synchronization date: "
+ "MessageBlockedEvent"
+ "Must take zero or more splits"
+ "NSCoding"
+ "NSSecureCoding"
+ "No accounts to handle"
+ "NotificationSettings"
+ "NotificationsNightlySync"
+ "Performing Batch Download request with cacheRequests:"
+ "Privacy acknowledgement result"
+ "Privacy task failed"
+ "Range requires lowerBound <= upperBound"
+ "Received download request. (\n\t batchKey: "
+ "Removing batchKey from all cached info for failed batchKey"
+ "Removing failed asset. (key: "
+ "SELECT areaID FROM areasByNamespace WHERE namespace = ?"
+ "SELECT areaID FROM areasByTopic WHERE topic = ?"
+ "SELECT endDate, identifier, startDate FROM treatments WHERE ("
+ "SELECT identifier, salt, seedBagNamespace, seedDomain, seedType FROM areas WHERE identifier = ?"
+ "Saved filePath with cacheKey: "
+ "Saved marketing item "
+ "Saving filePath:"
+ "Sending batch downloading failed event for batchKey: "
+ "Sending batch downloading finished event for batchKey: "
+ "Skipping event for "
+ "Starting Batch Download request with key:"
+ "Successfully enqueued event for "
+ "Successfully fetched marketing items. Count:"
+ "Swift/Array.swift"
+ "Swift/Collection.swift"
+ "Swift/ContiguousArrayBuffer.swift"
+ "Swift/IntegerTypes.swift"
+ "Swift/Range.swift"
+ "Swift/StringTesting.swift"
+ "Swift/StringUTF8View.swift"
+ "Swift/UnsafeBufferPointer.swift"
+ "Swift/UnsafePointer.swift"
+ "Swift/UnsafeRawPointer.swift"
+ "Synchronization was forced"
+ "T@\"AMSProcessInfo\",?,R,C,N"
+ "T@\"NSString\",?,R,C"
+ "T@\"_TtC14amsengagementd11JSMarketing\",N,R"
+ "T@\"_TtC14amsengagementd11JSMarketing\",N,R,Vmarketing"
+ "T@\"_TtC14amsengagementd5JSApp\",N,R"
+ "T@\"_TtC14amsengagementd5JSApp\",N,R,Vapp"
+ "TB,N"
+ "TB,R"
+ "TreatmentStoreLastSynchronizationDate"
+ "Unexpectedly found nil while unwrapping an Optional value"
+ "UnsafeMutableBufferPointer with negative count"
+ "UnsafeMutablePointer.initialize overlapping range"
+ "UnsafeMutablePointer.initialize with negative count"
+ "UnsafeMutablePointer.moveInitialize with negative count"
+ "UnsafeMutableRawPointer.initializeMemory overlapping range"
+ "UnsafeMutableRawPointer.initializeMemory with negative count"
+ "Update in progress already"
+ "_Concurrency/DiscardingTaskGroup.swift"
+ "_TtC14amsengagementd11JSMarketing"
+ "_TtC14amsengagementd15DisplayCriteria"
+ "_TtC14amsengagementd24DynamicTreatmentsStorage"
+ "_TtC14amsengagementd28DynamicTreatmentStoreService"
+ "_TtC14amsengagementd32NotificationSettingsEventManager"
+ "_TtC14amsengagementd34PreCalculatedTreatmentStoreService"
+ "_TtC14amsengagementd42DeviceAccountPrivacyAcknowledgementHandler"
+ "_TtC14amsengagementd5JSApp"
+ "_TtP14amsengagementd12JSAppExports_"
+ "_TtP14amsengagementdP33_28401EE6F2928884CB0AFC2DBB6AD9D818JSMarketingExports_"
+ "_enqueue:"
+ "additionalQueryParams"
+ "ams_accountWithAltDSID:DSID:username:accountTypeIdentifier:"
+ "amsengagementd.DisplayCriteria"
+ "amsengagementd.DynamicTreatmentStoreService"
+ "amsengagementd.JSApp"
+ "amsengagementd.JSMarketing"
+ "amsengagementd.PreCalculatedTreatmentStoreService"
+ "amsengagementd/DynamicTreatmentStoreService.swift"
+ "amsengagementd/NotificationSettingsEventManager.swift"
+ "are finished. Returning early"
+ "batchDownload:::"
+ "batchInfo:"
+ "batchKeys"
+ "batchRemove:"
+ "bundlePrivacyAcknowledgementRequest"
+ "cacheItem::"
+ "cacheURL"
+ "cachesDirectoryPath"
+ "com.apple.Fitness"
+ "contentsAtPath:"
+ "debugTreatmentSeparator"
+ "decodeIntegerForKey:"
+ "decodeObjectForKey:"
+ "displayCriteria(for:)"
+ "encodeInteger:forKey:"
+ "encodeObject:forKey:"
+ "encodeWithCoder:"
+ "engagement"
+ "enqueueEventIfNeeded(for:)"
+ "initWithBag:clientIdentifier:clientVersion:placement:serviceType:"
+ "invalid Collection: less than 'count' elements in collection"
+ "loadURLEventPromiseWithContext:"
+ "marketing"
+ "marketing-item-cache-enabled"
+ "mediaClient"
+ "metadata"
+ "metadataInfo:"
+ "notificationSettingsForTopics"
+ "notifyBlockedMessages:"
+ "performPrivacyAcknowledgement"
+ "performWithFetchOnly"
+ "purchaseSharingEnabled"
+ "rawValues"
+ "readJSON::"
+ "save::::"
+ "saveFilePath:::"
+ "seedBagNamespace"
+ "setContextInfo:"
+ "setOfferHints:"
+ "setSupportsSecureCoding:"
+ "sharedPaymentEnabled"
+ "shouldCollectMetricsPromiseForContext:"
+ "storageURL"
+ "supportsSecureCoding"
+ "synchronizationPromise"
+ "tracker"
+ "treatments-pre-calculation-disabled"
+ "unhandledURL"
+ "v16@?0@\"AMSEngagementEnqueueResult\"8"
+ "v16@?0@\"AMSMetricsLoadURLEvent\"8"
+ "v24@0:8@\"NSCoder\"16"
+ "v32@0:8@\"NSString\"16@\"JSValue\"24"
+ "v40@0:8@\"NSString\"16@\"JSValue\"24@\"NSDictionary\"32"
+ "v40@0:8@\"NSString\"16@\"NSString\"24@\"NSString\"32"
+ "v48@0:8@\"JSValue\"16@\"NSString\"24@\"NSString\"32@\"NSDictionary\"40"
+ "whenAuthenticated"
+ "xp_amp_notifications"
- ") VALUES (?,?,?,?,?,?);"
- "Creating JS stack."
- "Failed to create caches directory"
- "Failed to create engagement data vault directory: "
- "Failed to create engagement directory: "
- "Failed to create metrics identifier cloud data directory: "
- "Failed to create offline cache directory for account: "
- "Failed to create offline cache directory: "
- "Fetched extension value successfully."
- "File exists at destination. Removing old file."
- "Network not enabled"
- "Received download request. (\n\tkey: "
- "T@\"AMSProcessInfo\",R,C,N"
- "byteCodeCache path does not exist, creating (app: "
- "debugTreatments"
- "hasLinkediTunesAccount"
- "initWithContext:"
- "setError:"
- "shouldCollectMetricsForContext:"
- "treatmentStoreService"
- "v16@?0@8"

```
