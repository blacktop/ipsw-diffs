## apsd

> `/System/Library/PrivateFrameworks/ApplePushService.framework/apsd`

```diff

-1100.400.110.0.0
-  __TEXT.__text: 0x101ca4
-  __TEXT.__auth_stubs: 0x2d50
-  __TEXT.__objc_stubs: 0x10e80
+1100.500.181.0.0
+  __TEXT.__text: 0x108e90
+  __TEXT.__auth_stubs: 0x2e20
+  __TEXT.__objc_stubs: 0x112c0
   __TEXT.__init_offsets: 0x8
-  __TEXT.__objc_methlist: 0xab80
-  __TEXT.__const: 0x113a2
-  __TEXT.__objc_methname: 0x1aa4b
-  __TEXT.__oslogstring: 0x137a3
-  __TEXT.__objc_classname: 0xf40
-  __TEXT.__objc_methtype: 0x4709
-  __TEXT.__cstring: 0xa0d7
-  __TEXT.__gcc_except_tab: 0x25c8
+  __TEXT.__objc_methlist: 0xc740
+  __TEXT.__const: 0x11522
+  __TEXT.__objc_methname: 0x1b1d3
+  __TEXT.__oslogstring: 0x143c3
+  __TEXT.__objc_classname: 0xf7e
+  __TEXT.__objc_methtype: 0x4952
+  __TEXT.__cstring: 0xad17
+  __TEXT.__gcc_except_tab: 0x25b8
   __TEXT.__dlopen_cstrs: 0x58
   __TEXT.__ustring: 0x28
-  __TEXT.__swift5_typeref: 0x30f
-  __TEXT.__constg_swiftt: 0x48c
-  __TEXT.__swift5_reflstr: 0x276
-  __TEXT.__swift5_fieldmd: 0x284
-  __TEXT.__swift5_proto: 0x10
-  __TEXT.__swift5_types: 0x3c
-  __TEXT.__swift5_builtin: 0x3c
+  __TEXT.__swift5_typeref: 0x47d
+  __TEXT.__constg_swiftt: 0x644
+  __TEXT.__swift5_reflstr: 0x396
+  __TEXT.__swift5_fieldmd: 0x32c
+  __TEXT.__swift5_proto: 0x18
+  __TEXT.__swift5_types: 0x4c
+  __TEXT.__swift5_capture: 0x5c
+  __TEXT.__swift5_builtin: 0x50
+  __TEXT.__swift5_assocty: 0x18
   __TEXT.__swift5_mpenum: 0x8
-  __TEXT.__unwind_info: 0x3650
-  __TEXT.__eh_frame: 0x118
-  __DATA_CONST.__auth_got: 0x16c0
-  __DATA_CONST.__got: 0x7e0
-  __DATA_CONST.__auth_ptr: 0xa8
-  __DATA_CONST.__const: 0x5b18
-  __DATA_CONST.__cfstring: 0x8ae0
-  __DATA_CONST.__objc_classlist: 0x418
+  __TEXT.__unwind_info: 0x3828
+  __TEXT.__eh_frame: 0x130
+  __DATA_CONST.__auth_got: 0x1728
+  __DATA_CONST.__got: 0x7f8
+  __DATA_CONST.__auth_ptr: 0x100
+  __DATA_CONST.__const: 0x5d78
+  __DATA_CONST.__cfstring: 0x8d60
+  __DATA_CONST.__objc_classlist: 0x430
   __DATA_CONST.__objc_catlist: 0x8
-  __DATA_CONST.__objc_protolist: 0x1f8
+  __DATA_CONST.__objc_protolist: 0x208
   __DATA_CONST.__objc_imageinfo: 0x8
-  __DATA_CONST.__objc_protorefs: 0x68
-  __DATA_CONST.__objc_superrefs: 0x368
-  __DATA_CONST.__objc_intobj: 0x300
+  __DATA_CONST.__objc_protorefs: 0x70
+  __DATA_CONST.__objc_superrefs: 0x370
+  __DATA_CONST.__objc_intobj: 0x330
   __DATA_CONST.__objc_doubleobj: 0x10
   __DATA_CONST.__objc_arraydata: 0x88
   __DATA_CONST.__objc_arrayobj: 0x30
   __DATA_CONST.__objc_dictobj: 0x118
-  __DATA.__objc_const: 0x1ba80
-  __DATA.__objc_selrefs: 0x57f8
-  __DATA.__objc_ivar: 0xcb4
-  __DATA.__objc_data: 0x3148
-  __DATA.__data: 0x1800
-  __DATA.__bss: 0xfcc
-  __DATA.__common: 0x160
+  __DATA.__objc_const: 0x1b428
+  __DATA.__objc_selrefs: 0x5a50
+  __DATA.__objc_ivar: 0xcdc
+  __DATA.__objc_data: 0x31b8
+  __DATA.__data: 0x1990
+  __DATA.__bss: 0x109c
+  __DATA.__common: 0x118
   - /System/Library/Frameworks/ApplicationServices.framework/Versions/A/ApplicationServices
   - /System/Library/Frameworks/CFNetwork.framework/Versions/A/CFNetwork
   - /System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation

   - /usr/lib/swift/libswiftos.dylib
   - /usr/lib/swift/libswiftsys_time.dylib
   - /usr/lib/swift/libswiftunistd.dylib
-  UUID: 7C176FB3-557E-3317-80DE-FD7E6590B0D6
-  Functions: 5266
-  Symbols:   1031
-  CStrings:  8855
+  UUID: 0932F307-F3B1-3B1B-B604-927700B7E4A1
+  Functions: 5516
+  Symbols:   1059
+  CStrings:  9054
 
Symbols:
+ _$s10Foundation22_convertErrorToNSErrorySo0E0Cs0C0_pF
+ _$s10Foundation22_convertNSErrorToErrorys0E0_pSo0C0CSgF
+ _$s10Foundation4DataV11descriptionSSvg
+ _$s10Foundation4DataV19_bridgeToObjectiveCSo6NSDataCyF
+ _$s10Foundation4DataVMn
+ _$s10ObjectiveC8ObjCBoolVMn
+ _$s2os0A4_log_3dso0B0__ySo0a1_B7_type_ta_SVSo03OS_a1_B0Cs12StaticStringVs7CVarArg_pdtF
+ _$s8RawValueSYTl
+ _$sSS8UTF8ViewV13_foreignCountSiyF
+ _$sSY8rawValue03RawB0QzvgTq
+ _$sSY8rawValuexSg03RawB0Qz_tcfCTq
+ _$sSYMp
+ _$sSo13os_log_type_ta0A0E5errorABvgZ
+ _$sSo13os_log_type_ta0A0E5faultABvgZ
+ _$ss11_StringGutsV8copyUTF84intoSiSgSrys5UInt8VG_tF
+ _$ss11_StringGutsVN
+ _$ss13_StringObjectV10sharedUTF8SRys5UInt8VGvg
+ _$ss5ErrorMp
+ _$ss5UInt8VMn
+ _APSForceMacSleep
+ _APSRollTokenEntitlement
+ _APSUseMultiIdentityProvider
+ _NSDebugDescriptionErrorKey
+ _NSStringFromClass
+ __ZNSt3__117bad_function_callD1Ev
+ __ZTINSt3__117bad_function_callE
+ __ZTVNSt3__117bad_function_callE
+ _swift_arrayDestroy
+ _swift_arrayInitWithCopy
+ _swift_bridgeObjectRelease_n
+ _swift_deallocObject
+ _swift_errorRelease
+ _swift_errorRetain
+ _swift_initStackObject
- _$sSa12_endMutationyyFyXl_Ts5
- _$sSw10copyMemory4fromySW_tF
- _$ss18_fatalErrorMessage__4file4line5flagss5NeverOs12StaticStringV_A2HSus6UInt32VtF
- __ZNKSt9exception4whatEv
- __ZNSt9exceptionD2Ev
- _swift_once
CStrings:
+ "%@ asked to add errors to consecutiveConnectionFailureReason on invalid interface %@"
+ "%@ default set to force invalid albert cert"
+ "%@ default set, forcing invalid albert cert"
+ "%@ informed of a valid server presence. Ignoring."
+ "%@ informed of an invalid server presence. Not doing anything, the next presence will use the same identity."
+ "%@ swapping identity providers not supported, not using a multi identity provider"
+ "%@: Cached token: %@, type: %ld"
+ "%@: Choosing red list for topic %@ because apsd is pretending like the device is a sleep"
+ "%@: Client identity manager is noting a refresh in BAA certs, rolling push token for all environments in BAA"
+ "%@: Client identity manager is noting a swap in identity provider, clearing public token and terminating connection."
+ "%@: Forcing Mac to connect due to mac sleep default."
+ "%@: Forcing Mac to pretend like its asleep."
+ "%@: Received an invalid presence response with reason %@"
+ "%@: SecResult shows duplicate item, trying to update it. setTokenForDomain %@ appSpecificIdentifier %@  tokenData %@"
+ "%@: setTokenForDomain %@ tokenData %@ appSpecificIdentifier %@"
+ "644392"
+ "<user=%@, activeClients=%@, shouldUseInternet=%@, publicToken=%@, isIdentityAvailable=%@, identityStatus=%@, connectionServers=%@, deviceTopicManager=%@, channels=%@>"
+ "@\"<APSUserDependencies>\"40@0:8@\"<APSUser>\"16@\"APSEnvironment\"24@\"<APSClientIdentityProvider>\"32"
+ "@\"APSSystemTokenInfo\"24@0:8@\"APSEnvironment\"16"
+ "APNSBAARetryCount"
+ "APNSEnableBAAAuthenticationForDevices"
+ "APNSEnableBAAFallback"
+ "APNSUseBAAAuthenticationForDevicesPercentage"
+ "APSAliasUserIdentityProvider"
+ "APSBAAClientIdentityProvider failed to sign nonce with host VM identity, error: %@"
+ "APSClientIdentityProviderErrorDomain"
+ "APSIDSProxyManaer %@ received invalid object via IDS!"
+ "APSMultiClientIdentityProvider"
+ "APSMultiClientIdentityProviderDelegate"
+ "APSProtocolInvalidPresenceReason"
+ "APSProtocolServerRequestedTTR"
+ "APSSystemTokenInfo"
+ "APSSystemTokenInfo Serializing system token info to store in keychain, token: %@, type: %ld"
+ "APSSystemTokenInfo no token info found in keychain"
+ "APSSystemTokenInfoToken"
+ "APSSystemTokenInfoType"
+ "APSTokenStore fetching system token from keychain, environment: %@"
+ "APSTokenStore migrating token to new token info!"
+ "APSTokenStore setting system token in keychain for environment %@, token: %@, type: %ld"
+ "APSTokenStore storing no token in keychain"
+ "APSXPCRollTokensAndReconnectEvent, not entitled to roll tokens!"
+ "APSXPCRollTokensAndReconnectEvent, rolling tokens and forcing a reconnect"
+ "APSXPCSwapIdentityProviderEvent, asking %@ courier to swap identity providers"
+ "Albert"
+ "An internal APNS error has been detected, please file a radar!"
+ "Apple Push Service"
+ "B68@0:8^{__SecKey={__CFRuntimeBase=QAQ}^{__SecKeyDescriptor}^v}16^{__SecKey={__CFRuntimeBase=QAQ}^{__SecKeyDescriptor}^v}24@\"NSData\"32@\"NSNumber\"40B48^@52^@60"
+ "B68@0:8^{__SecKey={__CFRuntimeBase=QAQ}^{__SecKeyDescriptor}^v}16^{__SecKey={__CFRuntimeBase=QAQ}^{__SecKeyDescriptor}^v}24@32@40B48^@52^@60"
+ "BAA"
+ "BAAPhysicalDevicesInternal"
+ "Did not find APSSystemTokenInfo in keychain, token was stored as data directly: %@"
+ "Failed to deserialize APSSystemTokenInfo, error: %@"
+ "Force BAA cert failure default set"
+ "Force invalid albert cert default set"
+ "Found APSSystemTokenInfo, returning deserialized token info"
+ "Found an existing token in keychain to init clientIdentityManager for environment %@, token: %@, type: %s"
+ "Found an existing token in keychain to init multiClientIdentityProvider for environment %s, token: %s, type: %s"
+ "Found an existing token in keychain to init multiIdentityProvider for environment %@, token: %@, type: %s"
+ "I Didn't Try"
+ "IDSTapToRadar"
+ "IDSTapToRadarContext"
+ "IDSTapToRadarRequest"
+ "Incoming Proxy Messages"
+ "Internal Push Error Detected"
+ "MultiClientIdentityProvider albert provider not available, not swapping"
+ "MultiClientIdentityProvider attempting another BAA token before swapping identity provider"
+ "MultiClientIdentityProvider attempting to swap active identity provider"
+ "MultiClientIdentityProvider baa provider not available, not swapping"
+ "MultiClientIdentityProvider clearing presence errors after a successful presence"
+ "MultiClientIdentityProvider fetching identity, attempt number %ld"
+ "MultiClientIdentityProvider has BAA been disabled? %{bool}d"
+ "MultiClientIdentityProvider identity fetch failed"
+ "MultiClientIdentityProvider identity fetch failed too many times, swapping identity provider and returning no identity"
+ "MultiClientIdentityProvider identity provider not currently available, identity is not available"
+ "MultiClientIdentityProvider informed of a push token loss, attempting to upgrade to BAA if possible"
+ "MultiClientIdentityProvider noting an invalid presence from server"
+ "MultiClientIdentityProvider retrying identity fetch, retry #%ld"
+ "MultiClientIdentityProvider server bag has disabled BAA! Swapping identity providers"
+ "MultiClientIdentityProvider swapping identity provider if possible"
+ "MultiClientIdentityProvider swapping to BAA provider"
+ "MultiClientIdentityProvider swapping to albert provider"
+ "MultiClientIdentityProvider updating albert fallback enabled to %{bool}d"
+ "MultiClientIdentityProvider updating baa enabled to %{bool}d"
+ "MultiClientIdentityProvider updating retry count to %ld"
+ "MultiClientIdentityProvider updating server bag values"
+ "MultiClientIdentityProvider, currentIdentityProvider: %s, isIdentityAvailable:%{bool}d"
+ "MultiIdentityProvider default not set, rolled %u, shouldUseMultiProvider %@?"
+ "MultiIdentityProvider default set to not use multi identity provider"
+ "MultiIdentityProvider default set to use multi identity provider"
+ "No server reason given"
+ "No token found in keychain for environment %%%s, setting multiClientIdentityProvider status to BAA"
+ "No token found in keychain for environment %@, setting clientIdentityManager status to BAA"
+ "No token found in keychain for environment %@, setting multiIdentityProvider status to BAA"
+ "Outgoing Proxy Messages"
+ "Serious Bug"
+ "Server requested TTR, presence error reason: %@"
+ "T@\"<APSClientIdentityProvider>\",R,N,V_clientIdentityProvider"
+ "T@\"<APSClientIdentityProvider>\",W,N,V_identityProviderForMainCourier"
+ "T@\"<APSMultiClientIdentityProviderDelegate>\",N,W,Vdelegate"
+ "T@\"NSData\",R,N,V_systemToken"
+ "T@\"NSMutableDictionary\",&,N,V_mainQueue_incomingPowerLogDictionary"
+ "T@\"NSMutableDictionary\",&,N,V_mainQueue_outgoingPowerLogDictionary"
+ "T@\"NSObject<OS_dispatch_source>\",&,N,V_powerLogTimer"
+ "TB,N,V_swappingIdentity"
+ "The saved token type is BAA but we are not using the multi identity provider. The default to use the multi provider was likely lost!"
+ "Tq,N,R"
+ "Tq,N,V_tokenType"
+ "Unsupported VM host cert fetch"
+ "User dependencies for non-default users require a main identity provider!"
+ "[APNS] Tap-to-Radar: Internal push error detected"
+ "_identityProviderForMainCourier"
+ "_mainQueue_incomingPowerLogDictionary"
+ "_mainQueue_outgoingPowerLogDictionary"
+ "_powerLogTimer"
+ "_reportProxyMessages"
+ "_startPowerLoggingMessages"
+ "_stopPowerLoggingMessages"
+ "_swappingIdentity"
+ "_systemToken"
+ "_tokenInfoForDomain:userName:namespace:"
+ "_tokenType"
+ "_triggerTTRFromServer:"
+ "addConnectionFailureReasons:onInterface:"
+ "albertFallbackEnabled"
+ "albertIdentityProvider"
+ "all"
+ "apsd.AliasUserIdentityProvider"
+ "apsd.MultiClientIdentityProvider"
+ "baaEnabled"
+ "baaEnabledForDevices"
+ "baaIdentityProvider"
+ "baaRetryCount"
+ "clearCachedIdentityAndTokens"
+ "currentIdentityState"
+ "currentTokenType"
+ "debugForceIdentitySwap"
+ "dependenciesForUser:environment:mainIdentityProvider:"
+ "dependenciesWithNoIdentityForUser:"
+ "errorsSinceLastSuccessfulServerPresence"
+ "fetchVMHostCertsAndSignData:error:"
+ "flagsForPresence"
+ "force-invalid-BAA-cert"
+ "force-invalid-albert-cert"
+ "forceInvalidAlbertCert"
+ "forceInvalidBAACert"
+ "generateNonceAndSignatureWithPublicKey:privateKey:dataToSign:time:useIDSNonceVersion:nonceOut:signatureOut:"
+ "identityFetchErrors"
+ "identityProviderForMainCourier"
+ "identityStatus"
+ "initWithInt:"
+ "initWithMainUserIdentityProvider:"
+ "initWithPushTokenInKeychain:legacyIdentityProvider:delegate:"
+ "initWithSystemToken:type:"
+ "initWithTitle:message:"
+ "invalidateClientIdentity"
+ "kIDSTapToRadarClassificationKey"
+ "kIDSTapToRadarComponentIDKey"
+ "kIDSTapToRadarComponentNameKey"
+ "kIDSTapToRadarComponentVersionKey"
+ "kIDSTapToRadarDescriptionKey"
+ "kIDSTapToRadarReproducibilityKey"
+ "kIDSTapToRadarTitleKey"
+ "launchWithRequest:context:"
+ "mainQueue_incomingPowerLogDictionary"
+ "mainQueue_outgoingPowerLogDictionary"
+ "mainUserIdentityProvider"
+ "multiClientIdentityRampPercentage"
+ "noteInvalidServerPresence"
+ "notePushTokenLost"
+ "noteServerBagUpdate:"
+ "noteValidServerPresence"
+ "powerLogTimer"
+ "sendConnectMessageWithToken:presenceFlags:certificates:nonce:signature:hostCertificateInfo:connectionErrors:withCompletion:"
+ "serializeSystemTokenInfo"
+ "setIdentityProviderForMainCourier:"
+ "setIsIdentityAvailableBlockWithBlock:"
+ "setMainQueue_incomingPowerLogDictionary:"
+ "setMainQueue_outgoingPowerLogDictionary:"
+ "setPowerLogTimer:"
+ "setSwappingIdentity:"
+ "setSystemTokenInfo:forUser:"
+ "setTokenData:withDomain:appSpecificIdentifier:tokenServiceSuffix:user:topic:"
+ "setTokenInfo:forDomain:userName:"
+ "setTokenInfo:forDomain:userName:namespace:"
+ "setTokenInfo:forEnvironment:"
+ "setTokenType:"
+ "shouldSwapIdentityProviderAfterNextInvalidPresence"
+ "signatureTypeForSigning"
+ "supportsFetchingVMHostCerts"
+ "swappingIdentity"
+ "systemToken"
+ "systemTokenInfoForUser:"
+ "systemTokenInfoFromData:"
+ "tokenInfoForDomain:userName:"
+ "tokenInfoForDomain:userName:namespace:"
+ "tokenInfoForEnvironment:"
+ "tokenType"
+ "v24@0:8@\"APSConfiguration\"16"
+ "v28@0:8B16@?<v@?^{__SecKey={__CFRuntimeBase=QAQ}^{__SecKeyDescriptor}^v}@\"NSArray\"@\"NSError\">20"
+ "v32@0:8@\"APSSystemTokenInfo\"16@\"APSEnvironment\"24"
+ "v76@0:8@\"NSData\"16I24@\"NSArray\"28@\"NSData\"36@\"NSData\"44@\"APSDProtoHostCertificateInfo\"52@\"NSArray\"60@?<v@?@\"NSDictionary\"@\"NSError\">68"
+ "v76@0:8@16I24@28@36@44@52@60@?68"
- "%@(enabledTopics)"
- "%@(ignoredTopics)"
- "%@(nonWakingTopics)"
- "%@(opportunisticTopics)"
- "%@: BAA client identity provider is noting a refresh in BAA certs, noting to daemon to roll tokens for all environments in BAA"
- "%@: SecResult shows duplicate item, trying to update it. setTokenForDomain %@ appSpecificIdentifier %@  token %@"
- "%@: setTokenForDomain %@ token %@ appSpecificIdentifier %@"
- "<user=%@, activeClients=%@, shouldUseInternet=%@, publicToken=%@, isIdentityAvailable=%@, connectionServers=%@, deviceTopicManager=%@, channels=%@>"
- "@\"NSData\"24@0:8@\"APSEnvironment\"16"
- "APSBAAClientIdenittyProvider failed to sign nonce with host VM identity, error: %@"
- "APSIDSProxyManager %@ received invalid object via IDS!"
- "Courier Topics Changed"
- "Fatal error"
- "No host identity to fetch with no op identity provider, returning empty host certificate info which will be ignored by the courier"
- "Setting BAA flags on presence"
- "Swift/UnsafePointer.swift"
- "T@\"<APSClientIdentityProvider>\",&,N,V_clientIdentityProvider"
- "T@\"NSString\",&,N,V_processName"
- "UnsafeMutablePointer.initialize overlapping range"
- "UnsafeMutablePointer.initialize with negative count"
- "_logTopics"
- "_tokenForDomain:userName:namespace:"
- "dependenciesForUser:"
- "fetchHostVMCertAndSignNonce:error:"
- "setClientIdentityProvider:"
- "setProcessName:"
- "setToken:forDomain:userName:"
- "setToken:forDomain:userName:namespace:"
- "setToken:forEnvironment:"
- "setToken:withDomain:appSpecificIdentifier:tokenServiceSuffix:user:topic:"
- "shouldPowerLogEvent:"
- "systemTokenForUser:"
- "tokenForDomain:userName:"
- "tokenForDomain:userName:namespace:"
- "tokenForEnvironment:"
- "v28@0:8B16@?<v@?^{__SecKey={__CFRuntimeBase=QAQ}^{__SecKeyDescriptor}^v}@\"NSArray\">20"
- "v28@0:8B16@?<v@?^{__SecKey=}@\"NSArray\">20"
- "v32@0:8@\"NSData\"16@\"APSEnvironment\"24"

```
